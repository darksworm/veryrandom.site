<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CarpetChronicles.biz — The Commercial Carpeting Database</title>
<link rel="stylesheet" href="/assets/css/fonts.css">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #F2EDE4;
  --text: #2E2A26;
  --accent: #8B2942;
  --card-bg: #E8E1D6;
  --gray: #6B6560;
  --teal: #2D7A7B;
  --max-w: 960px;
}

body {
  font-family: 'Work Sans', Arial, sans-serif;
  background-color: var(--bg);
  color: var(--text);
  font-size: 16px;
  line-height: 1.55;
  min-height: 100vh;
  background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='20' height='20' fill='%23F2EDE4'/%3E%3Cpath d='M0 0h1v1H0zM2 0h1v1H2zM4 0h1v1H4zM6 0h1v1H6zM8 0h1v1H8zM10 0h1v1h-1zM12 0h1v1h-1zM14 0h1v1h-1zM16 0h1v1h-1zM18 0h1v1h-1zM1 1h1v1H1zM3 1h1v1H3zM5 1h1v1H5zM7 1h1v1H7zM9 1h1v1H9zM11 1h1v1h-1zM13 1h1v1h-1zM15 1h1v1h-1zM17 1h1v1h-1zM19 1h1v1h-1z' fill='%23EBE5DB' opacity='0.5'/%3E%3C/svg%3E");
}

a { color: var(--teal); text-decoration: underline; }
a:hover { color: var(--accent); }

.site-wrap {
  max-width: var(--max-w);
  margin: 0 auto;
  background: #FFFDF9;
  box-shadow: 0 0 30px rgba(46,42,38,0.15);
  border-left: 2px solid var(--gray);
  border-right: 2px solid var(--gray);
  min-height: 100vh;
}

/* HEADER */
.site-header {
  border-bottom: 3px double var(--gray);
  padding: 12px 16px;
  position: relative;
  overflow: hidden;
}
.header-top {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  flex-wrap: wrap;
  gap: 8px;
}
.site-title {
  font-family: 'Work Sans', Arial, sans-serif;
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--accent);
  letter-spacing: -0.5px;
}
.site-title small {
  font-size: 0.75rem;
  color: var(--gray);
  font-weight: 400;
  display: block;
}
.visitor-counter {
  font-family: 'Fira Code', monospace;
  font-size: 0.8rem;
  color: var(--gray);
  background: var(--card-bg);
  border: 1px solid var(--gray);
  padding: 2px 8px;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}
.counter-digit {
  display: inline-block;
  width: 1ch;
  text-align: center;
  position: relative;
  overflow: hidden;
  height: 1.3em;
  vertical-align: bottom;
}
.counter-digit span {
  display: block;
  transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}
.header-date {
  font-family: 'Fira Code', monospace;
  font-size: 0.75rem;
  color: var(--gray);
}

/* Coffee stain animation */
.coffee-stain {
  position: absolute;
  top: 8px;
  right: 16px;
  width: 60px;
  height: 60px;
  pointer-events: none;
}
.coffee-stain::before {
  content: '';
  position: absolute;
  width: 8px;
  height: 8px;
  background: radial-gradient(ellipse at center, #6B4226 0%, #8B6914 40%, transparent 70%);
  border-radius: 45% 55% 50% 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  animation: coffeeSpread 12s ease-out infinite;
  opacity: 0.35;
}
@keyframes coffeeSpread {
  0% { width: 6px; height: 6px; border-radius: 50%; opacity: 0.5; }
  15% { width: 20px; height: 18px; border-radius: 45% 55% 50% 50%; opacity: 0.4; }
  40% { width: 40px; height: 35px; border-radius: 42% 58% 55% 45%; opacity: 0.3; }
  70% { width: 55px; height: 48px; border-radius: 48% 52% 45% 55%; opacity: 0.2; }
  85% { width: 55px; height: 48px; border-radius: 48% 52% 45% 55%; opacity: 0.1; }
  100% { width: 55px; height: 48px; border-radius: 48% 52% 45% 55%; opacity: 0; }
}

/* Carpet of the Month */
.cotm {
  border: 2px solid var(--accent);
  background: var(--card-bg);
  padding: 12px;
  margin: 12px 16px;
}
.cotm-badge {
  font-family: 'Fira Code', monospace;
  font-size: 0.7rem;
  background: var(--teal);
  color: #FFFDF9;
  padding: 2px 8px;
  display: inline-block;
  margin-bottom: 6px;
  letter-spacing: 1px;
  text-transform: uppercase;
}
.cotm h2 {
  font-family: 'Work Sans', sans-serif;
  font-size: 1.1rem;
  color: var(--accent);
  margin-bottom: 4px;
}
.cotm-details {
  font-family: 'Fira Code', monospace;
  font-size: 0.75rem;
  color: var(--gray);
  line-height: 1.6;
}
.cotm-votes {
  font-family: 'Fira Code', monospace;
  font-size: 0.75rem;
  color: var(--teal);
  margin-top: 4px;
}

/* Main layout */
.main-grid {
  display: grid;
  grid-template-columns: 1fr 250px;
  border-top: 1px solid var(--gray);
}
.main-content {
  border-right: 1px solid var(--gray);
  min-width: 0;
}
.sidebar {
  padding: 12px;
  font-size: 0.85rem;
}

/* Sections */
.section {
  padding: 16px;
  border-bottom: 2px solid var(--gray);
}
.section-title {
  font-family: 'Work Sans', sans-serif;
  font-size: 1.15rem;
  font-weight: 700;
  color: var(--accent);
  border-bottom: 1px dashed var(--gray);
  padding-bottom: 4px;
  margin-bottom: 12px;
}

/* SEARCH */
.search-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 16px;
  align-items: flex-end;
}
.search-bar label {
  font-family: 'Fira Code', monospace;
  font-size: 0.7rem;
  color: var(--gray);
  display: block;
  margin-bottom: 2px;
}
.search-bar input,
.search-bar select {
  font-family: 'Fira Code', monospace;
  font-size: 0.8rem;
  border: 2px inset #C0C0C0;
  background: #FFFFFF;
  padding: 6px 8px;
  color: var(--text);
  min-height: 44px;
}
.search-bar input { flex: 1; min-width: 150px; }
.search-bar select { min-width: 120px; }
.search-bar button {
  font-family: 'Fira Code', monospace;
  font-size: 0.8rem;
  background: var(--card-bg);
  border: 2px outset #C0C0C0;
  padding: 6px 16px;
  cursor: pointer;
  color: var(--text);
  min-height: 44px;
}
.search-bar button:hover { background: #D6CFC4; }
.search-bar button:active { border-style: inset; }

/* Carpet cards */
.carpet-cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 12px;
}
.carpet-card {
  background: var(--card-bg);
  border: 1px solid var(--gray);
  padding: 10px;
  transition: transform 0.3s, opacity 0.3s;
}
.carpet-card.shuffling {
  opacity: 0;
  transform: translateY(10px);
}
.swatch-preview {
  width: 100%;
  height: 80px;
  border: 1px solid var(--gray);
  margin-bottom: 8px;
}
.carpet-card h3 {
  font-family: 'Work Sans', sans-serif;
  font-size: 0.9rem;
  font-weight: 600;
  margin-bottom: 2px;
}
.carpet-card .card-meta {
  font-family: 'Fira Code', monospace;
  font-size: 0.7rem;
  color: var(--gray);
  line-height: 1.5;
}

/* Oh No rating */
.oh-no-rating {
  display: flex;
  gap: 3px;
  align-items: center;
  margin-top: 6px;
  flex-wrap: wrap;
}
.oh-no-cup {
  width: 22px;
  height: 22px;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  transition: transform 0.15s;
  min-width: 44px;
  min-height: 44px;
}
.oh-no-cup:hover { transform: scale(1.2); }
.oh-no-cup svg {
  width: 20px;
  height: 20px;
  stroke: var(--gray);
  fill: none;
  transition: fill 0.2s;
}
.oh-no-cup.filled svg { fill: #6B4226; stroke: #4A2E19; }
.oh-no-cup.hovered svg { fill: #9B7B5E; stroke: #6B4226; }
.oh-no-avg {
  font-family: 'Fira Code', monospace;
  font-size: 0.65rem;
  color: var(--gray);
  margin-left: 6px;
}

/* MAP */
.map-container {
  position: relative;
  width: 100%;
  max-width: 600px;
  margin: 0 auto;
  aspect-ratio: 1.6 / 1;
  background: var(--card-bg);
  border: 1px solid var(--gray);
  overflow: hidden;
}
.map-outline {
  position: absolute;
  inset: 5%;
  opacity: 0.15;
}
.map-cluster {
  position: absolute;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background: var(--accent);
  opacity: 0.7;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Fira Code', monospace;
  font-size: 0.65rem;
  color: #FFFDF9;
  animation: clusterPulse 3s ease-in-out infinite;
  min-width: 44px;
  min-height: 44px;
}
.map-cluster:nth-child(odd) { animation-delay: -1.5s; }
@keyframes clusterPulse {
  0%, 100% { transform: scale(1); opacity: 0.7; }
  50% { transform: scale(1.1); opacity: 0.9; }
}
.map-tooltip {
  position: absolute;
  background: #FFFDF9;
  border: 1px solid var(--gray);
  padding: 8px;
  font-family: 'Fira Code', monospace;
  font-size: 0.7rem;
  color: var(--text);
  z-index: 10;
  pointer-events: none;
  box-shadow: 2px 2px 6px rgba(46,42,38,0.15);
  max-width: 200px;
  display: none;
  line-height: 1.4;
}
.map-tooltip.visible { display: block; }

.map-legend {
  font-family: 'Fira Code', monospace;
  font-size: 0.7rem;
  color: var(--gray);
  margin-top: 8px;
  padding: 6px;
  border: 1px dashed var(--gray);
  line-height: 1.6;
}

.incident-ticker {
  font-family: 'Fira Code', monospace;
  font-size: 0.75rem;
  color: var(--text);
  background: var(--card-bg);
  border: 1px solid var(--gray);
  padding: 6px 10px;
  margin-top: 10px;
  overflow: hidden;
  white-space: nowrap;
}
.ticker-inner {
  display: inline-block;
  animation: tickerScroll 30s linear infinite;
}
@keyframes tickerScroll {
  0% { transform: translateX(100%); }
  100% { transform: translateX(-100%); }
}

.map-detail-panel {
  margin-top: 12px;
  padding: 10px;
  background: var(--card-bg);
  border: 1px solid var(--gray);
  font-family: 'Fira Code', monospace;
  font-size: 0.75rem;
  display: none;
  line-height: 1.6;
}
.map-detail-panel.visible { display: block; }
.map-detail-panel h4 {
  font-family: 'Work Sans', sans-serif;
  font-size: 0.9rem;
  color: var(--accent);
  margin-bottom: 4px;
}

/* ASK AGNES */
.agnes-section {
  position: relative;
  border: none;
  padding: 16px;
  border-bottom: 2px solid var(--gray);
}
.torn-paper {
  background: #FFFDF9;
  border: 1px solid var(--gray);
  border-image: repeating-linear-gradient(135deg, var(--gray) 0px, var(--gray) 2px, transparent 2px, transparent 6px) 8;
  padding: 16px;
  position: relative;
}
.agnes-title {
  font-family: 'Permanent Marker', cursive;
  font-size: 1.3rem;
  color: var(--accent);
  margin-bottom: 10px;
}
.agnes-question {
  font-family: 'Work Sans', sans-serif;
  font-style: italic;
  margin-bottom: 8px;
  font-size: 0.9rem;
}
.agnes-answer {
  font-family: 'Permanent Marker', cursive;
  font-size: 0.95rem;
  color: var(--text);
  line-height: 1.6;
  margin-bottom: 8px;
}
.sticky-note {
  position: absolute;
  top: -8px;
  right: 12px;
  background: #F5E6A3;
  padding: 10px 14px;
  transform: rotate(3deg);
  box-shadow: 2px 2px 5px rgba(46,42,38,0.2);
  font-family: 'Permanent Marker', cursive;
  font-size: 0.8rem;
  color: var(--text);
  max-width: 180px;
  line-height: 1.4;
  z-index: 5;
}
.agnes-form label {
  font-family: 'Fira Code', monospace;
  font-size: 0.7rem;
  color: var(--gray);
  display: block;
  margin-bottom: 2px;
}
.agnes-form textarea {
  font-family: 'Work Sans', sans-serif;
  width: 100%;
  font-size: 0.85rem;
  border: 2px inset #C0C0C0;
  padding: 6px 8px;
  resize: vertical;
  min-height: 60px;
  color: var(--text);
  background: #FFFFFF;
}
.agnes-form button {
  font-family: 'Fira Code', monospace;
  font-size: 0.8rem;
  background: var(--card-bg);
  border: 2px outset #C0C0C0;
  padding: 6px 16px;
  cursor: pointer;
  margin-top: 6px;
  color: var(--text);
  min-height: 44px;
}
.agnes-form button:hover { background: #D6CFC4; }

/* CARPET TWINS */
.twins-viewer {
  margin-bottom: 16px;
}
.twins-pair {
  display: flex;
  gap: 0;
  position: relative;
  border: 1px solid var(--gray);
  overflow: hidden;
  height: 200px;
  margin-bottom: 8px;
  touch-action: none;
}
.twin-side {
  flex: 1;
  min-width: 0;
  position: relative;
  overflow: hidden;
}
.twin-swatch {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}
.twin-left-wrap {
  position: absolute;
  top: 0; left: 0; bottom: 0;
  width: 50%;
  overflow: hidden;
  z-index: 2;
}
.twin-right-wrap {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  z-index: 1;
}
.twin-divider {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 4px;
  background: var(--accent);
  cursor: ew-resize;
  z-index: 3;
  left: 50%;
  transform: translateX(-50%);
  min-width: 20px;
  margin-left: -8px;
}
.twin-divider::after {
  content: '⟺';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--accent);
  color: #FFFDF9;
  padding: 2px 4px;
  font-size: 0.7rem;
  border-radius: 2px;
}
.twin-meta {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  font-family: 'Fira Code', monospace;
  font-size: 0.7rem;
  color: var(--gray);
  line-height: 1.5;
}
.connection-prob {
  text-align: center;
  font-family: 'Fira Code', monospace;
  font-size: 0.85rem;
  color: var(--teal);
  margin: 6px 0;
  font-weight: 700;
}
.theories {
  font-size: 0.8rem;
  color: var(--gray);
  font-style: italic;
  margin-top: 6px;
  padding: 6px;
  border-top: 1px dashed var(--gray);
  line-height: 1.5;
}

/* ABOUT */
.about-text {
  font-size: 0.9rem;
  line-height: 1.65;
  margin-bottom: 12px;
}
.about-text p { margin-bottom: 10px; }
.photo-frame {
  border: 3px solid var(--gray);
  background: var(--card-bg);
  padding: 6px;
  display: inline-block;
  margin: 8px 0;
}
.photo-placeholder {
  width: 200px;
  height: 140px;
  background: #D6CFC4;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Fira Code', monospace;
  font-size: 0.65rem;
  color: var(--gray);
  text-align: center;
  padding: 10px;
}
.photo-caption {
  font-family: 'Fira Code', monospace;
  font-size: 0.65rem;
  color: var(--gray);
  margin-top: 4px;
  line-height: 1.4;
}
.disclaimer {
  font-family: 'Fira Code', monospace;
  font-size: 0.7rem;
  color: var(--accent);
  border: 1px solid var(--accent);
  padding: 8px;
  margin-top: 12px;
  line-height: 1.5;
}

/* SIDEBAR */
.sidebar-block {
  border: 1px solid var(--gray);
  padding: 8px;
  margin-bottom: 12px;
  background: var(--card-bg);
}
.sidebar-block h3 {
  font-family: 'Fira Code', monospace;
  font-size: 0.75rem;
  color: var(--accent);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 6px;
  border-bottom: 1px dotted var(--gray);
  padding-bottom: 4px;
}
.sidebar-block p, .sidebar-block li {
  font-size: 0.8rem;
  line-height: 1.5;
}
.sidebar-block ul {
  list-style: none;
  padding: 0;
}
.sidebar-block li {
  padding: 3px 0;
  border-bottom: 1px dotted var(--gray);
}
.sponsor-ad {
  border: 3px double var(--accent);
  padding: 10px;
  text-align: center;
  background: #FFFDF9;
}
.sponsor-ad .ad-title {
  font-family: 'Archivo Black', sans-serif;
  font-size: 0.9rem;
  color: var(--accent);
  margin-bottom: 4px;
}
.sponsor-ad p {
  font-size: 0.75rem;
  color: var(--gray);
  line-height: 1.4;
}
.agnes-status {
  font-family: 'Fira Code', monospace;
  font-size: 0.7rem;
  color: var(--gray);
  line-height: 1.5;
}
.agnes-status strong { color: var(--accent); }

/* FOOTER */
.site-footer {
  padding: 16px;
  border-top: 3px double var(--gray);
  text-align: center;
}
.seal-badge {
  display: inline-block;
  border: 2px solid var(--teal);
  border-radius: 50%;
  width: 70px;
  height: 70px;
  line-height: 1.1;
  padding: 10px 5px;
  font-family: 'Fira Code', monospace;
  font-size: 0.5rem;
  color: var(--teal);
  margin: 8px auto;
  text-align: center;
}
.footer-sponsor {
  border: 2px dashed var(--accent);
  padding: 10px;
  margin-bottom: 12px;
  background: var(--card-bg);
}
.footer-sponsor p {
  font-size: 0.8rem;
  color: var(--gray);
}
.footer-copy {
  font-family: 'Fira Code', monospace;
  font-size: 0.7rem;
  color: var(--gray);
  margin-top: 8px;
  line-height: 1.6;
}
.footer-copy a { font-size: 0.7rem; }
.newsletter-form {
  margin-top: 10px;
  display: flex;
  gap: 6px;
  justify-content: center;
  flex-wrap: wrap;
}
.newsletter-form input {
  font-family: 'Fira Code', monospace;
  font-size: 0.75rem;
  border: 2px inset #C0C0C0;
  padding: 4px 8px;
  min-height: 44px;
  color: var(--text);
}
.newsletter-form button {
  font-family: 'Fira Code', monospace;
  font-size: 0.75rem;
  background: var(--teal);
  color: #FFFDF9;
  border: none;
  padding: 4px 12px;
  cursor: pointer;
  min-height: 44px;
}
.newsletter-form button:hover { background: #246061; }

/* Scroll reveal */
.reveal-section {
  clip-path: inset(100% 0 0 0);
  opacity: 0;
  transition: clip-path 0.8s ease-out, opacity 0.6s ease-out;
}
.reveal-section.revealed {
  clip-path: inset(0 0 0 0);
  opacity: 1;
}

/* Swatch pattern generators */
.swatch-geometric {
  background: repeating-linear-gradient(45deg, #8B2942 0px, #8B2942 8px, #2D7A7B 8px, #2D7A7B 16px, #E8E1D6 16px, #E8E1D6 24px);
}
.swatch-floral {
  background: radial-gradient(circle at 25% 25%, #8B2942 3px, transparent 3px),
    radial-gradient(circle at 75% 75%, #2D7A7B 3px, transparent 3px),
    radial-gradient(circle at 50% 50%, #6B6560 2px, transparent 2px),
    #E8E1D6;
  background-size: 24px 24px;
}
.swatch-abstract {
  background: conic-gradient(from 45deg at 50% 50%, #8B2942, #E8E1D6, #2D7A7B, #6B6560, #8B2942);
  background-size: 30px 30px;
}
.swatch-plaid {
  background:
    repeating-linear-gradient(0deg, transparent, transparent 10px, rgba(139,41,66,0.3) 10px, rgba(139,41,66,0.3) 12px),
    repeating-linear-gradient(90deg, transparent, transparent 10px, rgba(45,122,123,0.3) 10px, rgba(45,122,123,0.3) 12px),
    #E8E1D6;
}
.swatch-solid-teal { background: #5A9A9B; }
.swatch-mystery {
  background: repeating-conic-gradient(#8B2942 0% 25%, #E8E1D6 0% 50%) 0 0 / 20px 20px;
}

/* Twin swatches */
.twin-swatch-a {
  background: repeating-linear-gradient(45deg, #8B2942 0px, #8B2942 6px, #2D7A7B 6px, #2D7A7B 12px, #F2EDE4 12px, #F2EDE4 18px);
}
.twin-swatch-b {
  background: repeating-linear-gradient(45deg, #8A2840 0px, #8A2840 6px, #2E7B7C 6px, #2E7B7C 12px, #F1ECE3 12px, #F1ECE3 18px);
}

/* MAP US outline simplified */
.us-outline {
  fill: none;
  stroke: var(--gray);
  stroke-width: 1;
}

/* Responsive */
@media (max-width: 768px) {
  .main-grid {
    grid-template-columns: 1fr;
  }
  .main-content { border-right: none; }
  .sidebar {
    border-top: 2px solid var(--gray);
  }
  .sticky-note {
    position: relative;
    top: auto;
    right: auto;
    margin-bottom: 10px;
    display: inline-block;
  }
  .twins-pair { height: 160px; }
  .coffee-stain { display: none; }
}

@media (max-width: 480px) {
  .site-title { font-size: 1.2rem; }
  .carpet-cards { grid-template-columns: 1fr; }
  .search-bar { flex-direction: column; }
  .search-bar input, .search-bar select { width: 100%; }
  .twin-meta { grid-template-columns: 1fr; }
  .photo-placeholder { width: 160px; height: 110px; }
}
</style>
</head>
<body>
<div class="site-wrap" x-data="carpetApp()">

  <!-- HEADER -->
  <header class="site-header">
    <div class="coffee-stain"></div>
    <div class="header-top">
      <div>
        <div class="site-title">
          CarpetChronicles.biz
          <small>The Commercial Carpeting Database of Record</small>
        </div>
      </div>
      <div style="text-align:right;">
        <div class="visitor-counter">
          Visitors:
          <span class="counter-digit"><span>0</span></span><span class="counter-digit"><span>0</span></span><span class="counter-digit"><span x-text="visitorCount[0]">2</span></span><span class="counter-digit"><span>,</span></span><span class="counter-digit"><span x-text="visitorCount[1]">8</span></span><span class="counter-digit"><span x-text="visitorCount[2]">4</span></span><span class="counter-digit" id="last-digit"><span x-text="visitorCount[3]" :style="digitFlip ? 'transform:translateY(-100%);transition:transform 0.4s' : 'transform:translateY(0);transition:none'">7</span></span>
        </div>
        <div class="header-date" x-text="currentDate"></div>
      </div>
    </div>

    <!-- Carpet of the Month -->
    <div class="cotm">
      <span class="cotm-badge">&#9733; Carpet of the Month</span>
      <h2>"Autumn Geometry" &mdash; Mama Rose's Italian Restaurant, Terre Haute, IN</h2>
      <div class="cotm-details">
        Pattern: Teal &amp; Maroon Geometric &nbsp;|&nbsp; Installed: 1994 &nbsp;|&nbsp; Fiber: Nylon 6,6 Loop<br>
        Stain Incidents: 247 (verified) &nbsp;|&nbsp; Last Cleaned: "Unclear"
      </div>
      <div class="cotm-votes">&#9650; 1,204 votes &mdash; "It's uglier in person and I mean that as the highest compliment." &mdash; user terrehaute_dan</div>
    </div>
  </header>

  <!-- MAIN LAYOUT -->
  <div class="main-grid">
    <div class="main-content">

      <!-- SEARCH THE ARCHIVE -->
      <div class="section reveal-section">
        <div class="section-title">Search the Archive</div>
        <div class="search-bar">
          <div>
            <label>KEYWORD</label>
            <input type="text" placeholder="e.g. burgundy loop" x-model="searchKeyword" aria-label="Search keyword">
          </div>
          <div>
            <label>YEAR</label>
            <select x-model="filterYear" aria-label="Filter by year">
              <option value="all">All Years</option>
              <template x-for="y in years" :key="y">
                <option :value="y" x-text="y"></option>
              </template>
            </select>
          </div>
          <div>
            <label>PATTERN</label>
            <select x-model="filterPattern" aria-label="Filter by pattern">
              <option value="all">All Patterns</option>
              <option value="geometric">&#9632; Geometric</option>
              <option value="floral">&#10047; Floral</option>
              <option value="abstract">&#9674; Abstract</option>
              <option value="solid">&#9608; Solid</option>
              <option value="plaid">&#9638; Plaid</option>
              <option value="mystery">? Mystery</option>
            </select>
          </div>
          <div>
            <label>STAINS</label>
            <select x-model="filterStains" aria-label="Filter by stain count">
              <option value="all">Any</option>
              <option value="low">0-10</option>
              <option value="med">11-50</option>
              <option value="high">51+</option>
            </select>
          </div>
          <button @click="shuffleCards()">Search</button>
        </div>

        <div class="carpet-cards">
          <template x-for="(card, idx) in filteredCards" :key="card.id">
            <div class="carpet-card" :class="{ shuffling: isShuffling }">
              <div class="swatch-preview" :class="'swatch-' + card.swatchClass"></div>
              <h3 x-text="card.name"></h3>
              <div class="card-meta">
                <span x-text="card.location"></span><br>
                <span x-text="card.pattern + ' | ' + card.year"></span><br>
                <span x-text="'Stain Incidents: ' + card.stains"></span>
              </div>
              <div class="oh-no-rating">
                <template x-for="cup in 5" :key="card.id + '-cup-' + cup">
                  <span class="oh-no-cup"
                    :class="{
                      filled: card.userRating >= cup,
                      hovered: card.hoverRating >= cup && card.userRating < cup
                    }"
                    @mouseenter="card.hoverRating = cup"
                    @mouseleave="card.hoverRating = 0"
                    @click="rateCard(card, cup)">
                    <svg viewBox="0 0 20 20"><path d="M4 5h12v8a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V5z"/><path d="M16 7h1.5a2 2 0 0 1 0 4H16"/><line x1="6" y1="2" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="2" x2="14" y2="4"/></svg>
                  </span>
                </template>
                <span class="oh-no-avg" x-text="'Avg: ' + card.avgRating.toFixed(1) + ' Oh Nos'"></span>
              </div>
            </div>
          </template>
        </div>
      </div>

      <!-- STAIN INCIDENT MAP -->
      <div class="section reveal-section">
        <div class="section-title">Stain Incident Map</div>
        <p style="font-size:0.8rem;color:#6B6560;margin-bottom:8px;font-family:'Fira Code',monospace;">Reported incidents, 2017&ndash;2025. Hover for details. Click for full report.</p>

        <div class="map-container" id="stain-map">
          <svg class="map-outline" viewBox="0 0 960 600" preserveAspectRatio="xMidYMid meet">
            <path class="us-outline" d="M 150 150 L 300 100 450 110 600 100 750 130 800 200 780 300 800 400 700 480 550 500 400 490 300 480 200 450 120 350 100 250 Z"/>
          </svg>
          <template x-for="(cluster, idx) in mapClusters" :key="idx">
            <div class="map-cluster"
              :style="'left:' + cluster.x + '%;top:' + cluster.y + '%'"
              @mouseenter="showTooltip(cluster, $event)"
              @mouseleave="hideTooltip()"
              @click="selectCluster(cluster)"
              x-text="cluster.count">
            </div>
          </template>
          <div class="map-tooltip" id="map-tooltip"
            :class="{ visible: activeTooltip }"
            :style="tooltipStyle">
            <template x-if="activeTooltip">
              <div>
                <strong x-text="activeTooltip.name" style="color:#8B2942"></strong><br>
                <span x-text="'Stain: ' + activeTooltip.stainType"></span><br>
                <span x-text="'Severity: ' + activeTooltip.severity + '/5 Oh Nos'"></span>
              </div>
            </template>
          </div>
        </div>

        <div class="map-legend">
          <strong>The "Oh No" Scale:</strong>
          &#9749; = Minor spill &nbsp; &#9749;&#9749; = Noticeable &nbsp; &#9749;&#9749;&#9749; = Concerning &nbsp; &#9749;&#9749;&#9749;&#9749; = Call someone &nbsp; &#9749;&#9749;&#9749;&#9749;&#9749; = Agnes wept
        </div>

        <div class="incident-ticker">
          <span class="ticker-inner">
            NEW: Red wine, severity 4, near the jukebox &mdash; Rosie's Lanes, Akron OH &nbsp;&#9749;&nbsp; | &nbsp;
            UPDATE: Mustard incident at Gate C4, O'Hare &mdash; upgraded to severity 3 &nbsp;&#9749;&nbsp; | &nbsp;
            VERIFIED: Coffee ring, severity 1, reception desk &mdash; Allstate office, Peoria IL &nbsp;&#9749;&nbsp; | &nbsp;
            DISPUTED: "That's not a stain, that's the pattern" &mdash; DMV, Reno NV &nbsp;&#9749;&nbsp; | &nbsp;
            NEW: Grape juice, severity 5, entire aisle 7 &mdash; First Methodist, Tupelo MS &nbsp;&#9749;
          </span>
        </div>

        <div class="map-detail-panel" :class="{ visible: selectedCluster }" id="detail-panel">
          <template x-if="selectedCluster">
            <div>
              <h4 x-text="selectedCluster.name"></h4>
              <p x-text="'Location: ' + selectedCluster.fullLocation"></p>
              <p x-text="'Primary Stain Type: ' + selectedCluster.stainType"></p>
              <p x-text="'Severity: ' + selectedCluster.severity + '/5'"></p>
              <p x-text="'Last Surveyed: ' + selectedCluster.lastSurveyed"></p>
              <p x-text="'Notes: ' + selectedCluster.notes"></p>
            </div>
          </template>
        </div>
      </div>

      <!-- ASK AGNES -->
      <div class="agnes-section reveal-section">
        <div class="torn-paper">
          <div class="sticky-note">Agnes — if you're reading this, call me. — B.</div>
          <div class="agnes-title">Ask Agnes</div>
          <div class="agnes-question">
            <strong>Q:</strong> "Dear Agnes, my orthodontist has this blue-gray carpet that I swear I've seen at a Ramada in Tucson. Am I losing my mind?"
            &mdash; Confused in Cincinnati
          </div>
          <div class="agnes-answer">
            You're not crazy. That's Mohawk Group's "Pacific Drift" in colorway 4B, manufactured 1998–2003. It was bulk-ordered by three different franchise chains and at least forty independent medical offices. I've personally documented it in eleven states. The Ramada in Tucson is a confirmed match. Congratulations, you have a gift. Use it wisely.
          </div>
          <p style="font-size:0.75rem;color:#6B6560;font-style:italic;margin-bottom:12px;">
            Agnes rated this one 2 Oh Nos but she was generous.
          </p>

          <div class="agnes-form" @submit.prevent>
            <label>SUBMIT YOUR STAIN QUESTION</label>
            <textarea placeholder="Describe the carpet, the stain, and your emotional state..." aria-label="Your stain question"></textarea>
            <br>
            <button type="button" @click="submitQuestion()">Send to Agnes</button>
            <span x-show="questionSent" style="font-family:'Fira Code',monospace;font-size:0.7rem;color:#2D7A7B;margin-left:8px;">
              Submitted. Agnes may or may not respond. We don't know where she is.
            </span>
          </div>
        </div>
      </div>

      <!-- CARPET TWINS GALLERY -->
      <div class="section reveal-section">
        <div class="section-title">Carpet Twins Gallery</div>
        <p style="font-size:0.8rem;color:#6B6560;margin-bottom:12px;">Suspiciously identical carpets found in unrelated locations. Coincidence? We document. You decide.</p>

        <template x-for="(pair, pairIdx) in twinPairs" :key="pairIdx">
          <div class="twins-viewer">
            <div class="twins-pair"
              @mousedown="startDrag($event, pairIdx)"
              @touchstart.passive="startDrag($event, pairIdx)">
              <div class="twin-left-wrap" :id="'twin-left-' + pairIdx" :style="'width:' + pair.dividerPos + '%'">
                <div class="twin-swatch" :class="pair.swatchA" style="position:absolute;top:0;left:0;width:200%;height:100%;"></div>
              </div>
              <div class="twin-right-wrap">
                <div class="twin-swatch" :class="pair.swatchB"></div>
              </div>
              <div class="twin-divider" :style="'left:' + pair.dividerPos + '%'"></div>
            </div>
            <div class="connection-prob" x-text="'Connection Probability: ' + pair.probability + '%'"></div>
            <div class="twin-meta">
              <div>
                <strong style="color:#8B2942" x-text="pair.labelA"></strong><br>
                <span x-text="pair.locA"></span><br>
                <span x-text="pair.yearA + ' | ' + pair.fiberA"></span>
              </div>
              <div>
                <strong style="color:#2D7A7B" x-text="pair.labelB"></strong><br>
                <span x-text="pair.locB"></span><br>
                <span x-text="pair.yearB + ' | ' + pair.fiberB"></span>
              </div>
            </div>
            <div class="theories">
              <strong>User Theories:</strong> <span x-text="pair.theories"></span>
            </div>
          </div>
        </template>
      </div>

      <!-- ABOUT / THE MISSION -->
      <div class="section reveal-section">
        <div class="section-title">About CarpetChronicles.biz</div>
        <div class="about-text">
          <p>My name is Barnaby Finch. I am a textile conservator. I repair old rugs and tapestries for museums, mostly, and sometimes for people who inherited something they can't afford to keep and can't bear to throw away. That's how I met Agnes Plumtree. She brought in a piece of commercial broadloom from a demolished Holiday Inn and asked me to stabilize it for archival storage. I thought she was insane. She was. I helped her anyway.</p>

          <p>Agnes started CarpetChronicles in 2017 because she believed — and I have come to believe she was right — that commercial carpeting is the most overlooked primary source material in American material culture. Every pattern chosen by a committee. Every stain a small human event. Every replacement a decision to erase history and call it improvement.</p>

          <p>In October 2021, Agnes drove to Tonopah, Nevada, to photograph a reportedly pristine 1972 shag installation in a closed bowling alley. She sent me a text at 11:47 PM that read: "Barnaby. It's magnificent. The pile depth alone." That was the last I heard from her.</p>

          <p>I maintain this database because she asked me to and because someone should. If you think this is a joke, you're welcome to think that. But the carpet under your feet right now was chosen by someone, installed by someone, and walked on by everyone, and not one of them thought to write it down. We write it down.</p>
        </div>

        <div class="photo-frame">
          <div class="photo-placeholder">[ PHOTOGRAPH ]<br>Silver gelatin print<br>120mm film</div>
          <div class="photo-caption">Agnes Plumtree, 2019, photographing the carpet<br>at Gate B7, McCarran International Airport.</div>
        </div>

        <div class="disclaimer">
          NOTICE: PatternVerse.ai has been scraping this database without permission since March 2023. Their "AI Carpet Identifier" is trained on our volunteer-submitted data. They have context for none of it. They identified Mama Rose's "Autumn Geometry" as "retro office tile." Agnes would have had words. I have a lawyer.
        </div>
      </div>
    </div>

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-block sponsor-ad">
        <div class="ad-title">STANLEY STEEMER</div>
        <p>"Gets carpets cleaner."&trade;</p>
        <p style="font-size:0.65rem;color:#6B6560;margin-top:4px;">Ad paid for. We needed the money. Agnes would understand.</p>
      </div>

      <div class="sidebar-block">
        <h3>Carpets in the News</h3>
        <ul>
          <li><a href="#!">Marriott announces chain-wide carpet replacement (we weep)</a></li>
          <li><a href="#!">Ohio man finds 1987 original under three layers of vinyl</a></li>
          <li><a href="#!">Congress votes on carpet preservation amendment (it failed)</a></li>
          <li><a href="#!">PatternVerse.ai raises $12M to "disrupt floor identification"</a></li>
        </ul>
      </div>

      <div class="sidebar-block">
        <h3>Agnes: Last Known</h3>
        <div class="agnes-status">
          <strong>Status: Missing</strong><br>
          Last confirmed: Tonopah, NV<br>
          Date: Oct 14, 2021<br>
          Vehicle: 2004 Subaru Outback, green, bumper sticker reads "HONK IF YOU LOVE BROADLOOM"<br><br>
          If you have information, contact:<br>
          <a href="#!">tips@carpetchronicles.biz</a>
        </div>
      </div>

      <div class="sidebar-block">
        <h3>Top Contributors</h3>
        <ul>
          <li>terrehaute_dan — 847 entries</li>
          <li>loopqueen99 — 612 entries</li>
          <li>agnes_p (inactive) — 2,341 entries</li>
          <li>barnaby_f — 489 entries</li>
          <li>mysterystain_OH — 203 entries</li>
        </ul>
      </div>

      <div class="sidebar-block">
        <h3>Database Stats</h3>
        <p style="font-family:'Fira Code',monospace;font-size:0.7rem;line-height:1.8;">
          Total entries: 14,837<br>
          Verified stains: 6,102<br>
          Patterns catalogued: 892<br>
          States covered: 47/50<br>
          <span style="color:#8B2942;">Missing: Alaska, Hawaii, Delaware (no volunteers)</span>
        </p>
      </div>
    </aside>
  </div>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="footer-sponsor">
      <div style="font-family:'Archivo Black',sans-serif;color:#8B2942;font-size:1rem;">STANLEY STEEMER &mdash; OFFICIAL SPONSOR</div>
      <p>"We don't ask why it's there. We just clean it." Call 1-800-STEEMER.</p>
    </div>
    <div class="seal-badge">
      &#9733;<br>CC.biz<br>SEAL OF<br>APPROVAL
    </div>
    <div class="footer-copy">
      &copy; 2017&ndash;2025 CarpetChronicles.biz &mdash; Est. by A. Plumtree &amp; B. Finch.<br>
      All carpet photographs and stain documentation are volunteer-submitted and used with permission.<br>
      <a href="#!">Have you seen Agnes? Contact us.</a>
    </div>
    <div class="newsletter-form" @submit.prevent>
      <input type="email" placeholder="Email for The Pile newsletter" aria-label="Email for newsletter">
      <button type="button" @click="subscribePile()">Subscribe to The Pile</button>
    </div>
    <p x-show="pileSubscribed" style="font-family:'Fira Code',monospace;font-size:0.7rem;color:#2D7A7B;margin-top:6px;">
      Welcome to The Pile. Monthly. Unsubscribe anytime. But why would you.
    </p>
  </footer>

</div>

<script src="/assets/js/gsap.min.js"></script>
<script src="/assets/js/alpine.min.js" defer></script>
<script>
document.addEventListener('alpine:init', function() {
  Alpine.data('carpetApp', function() {
    return {
      // Visitor counter
      visitorCount: ['2', '8', '4', '7'],
      digitFlip: false,
      counterInterval: null,

      // Search
      searchKeyword: '',
      filterYear: 'all',
      filterPattern: 'all',
      filterStains: 'all',
      isShuffling: false,
      years: (function() {
        var arr = [];
        for (var y = 2025; y >= 1965; y--) arr.push(y);
        return arr;
      })(),

      // Cards data
      allCards: [
        { id: 1, name: '"Autumn Geometry"', location: 'Mama Rose\'s, Terre Haute IN', pattern: 'geometric', year: 1994, stains: 247, swatchClass: 'geometric', userRating: 0, hoverRating: 0, avgRating: 3.7 },
        { id: 2, name: '"Pacific Drift"', location: 'Ramada Inn, Tucson AZ', pattern: 'abstract', year: 1999, stains: 83, swatchClass: 'abstract', userRating: 0, hoverRating: 0, avgRating: 2.1 },
        { id: 3, name: '"Federal Beige #4"', location: 'SSA Office, Columbus OH', pattern: 'solid', year: 2002, stains: 12, swatchClass: 'solid-teal', userRating: 0, hoverRating: 0, avgRating: 1.4 },
        { id: 4, name: '"Meadow Dance"', location: 'Dr. Whitfield\'s Dental, Tampa FL', pattern: 'floral', year: 1991, stains: 56, swatchClass: 'floral', userRating: 0, hoverRating: 0, avgRating: 4.2 },
        { id: 5, name: '"Tartan Grief"', location: 'VFW Post 1138, Erie PA', pattern: 'plaid', year: 1987, stains: 189, swatchClass: 'plaid', userRating: 0, hoverRating: 0, avgRating: 4.8 },
        { id: 6, name: '"Unknown Sample #77"', location: 'Abandoned Sears, Gary IN', pattern: 'mystery', year: 1978, stains: 0, swatchClass: 'mystery', userRating: 0, hoverRating: 0, avgRating: 3.3 }
      ],

      // Map
      mapClusters: [
        { x: 22, y: 42, count: 14, name: "Rosie's Lanes", fullLocation: "Rosie's Bowling Lanes, Akron OH", stainType: "Red wine", severity: 4, lastSurveyed: "Jan 2025", notes: "Wine stain near jukebox, lane 7. Source traced to Tuesday league night. Carpet is original 1988 installation. Owner refuses to replace it. Agnes documented this one personally in 2019." },
        { x: 55, y: 30, count: 8, name: "O'Hare Terminal C", fullLocation: "O'Hare International Airport, Gate C4, Chicago IL", stainType: "Mustard", severity: 3, lastSurveyed: "Nov 2024", notes: "Recurring hot dog condiment incidents near the Auntie Anne's. Carpet replaced 2018 but already showing chronic staining. Previous installation lasted 22 years. This one won't." },
        { x: 80, y: 55, count: 23, name: "First Methodist", fullLocation: "First Methodist Church, Fellowship Hall, Tupelo MS", stainType: "Grape juice", severity: 5, lastSurveyed: "Sep 2024", notes: "Communion Sunday, 2024. Entire aisle 7. The pastor called it 'an act of God.' Agnes would have called it 'an act of someone who shouldn't carry a tray.' We logged it as severity 5: Agnes Wept." },
        { x: 35, y: 60, count: 6, name: "Allstate Regional", fullLocation: "Allstate Insurance, Regional Office, Peoria IL", stainType: "Coffee", severity: 1, lastSurveyed: "Dec 2024", notes: "Single ring stain on reception carpet. Barely visible. Logged for completeness. This is how it starts — one ring, then a constellation. Give it three years." },
        { x: 70, y: 25, count: 11, name: "DMV Reno", fullLocation: "Department of Motor Vehicles, Reno NV", stainType: "Disputed", severity: 2, lastSurveyed: "Aug 2024", notes: "Multiple reports of a 'large brown stain' near window 6. On-site investigation by volunteer revealed it is, in fact, the pattern. The carpet is Mohawk 'Desert Vista' in colorway 3A. The pattern just looks like a stain. We filed it anyway." },
        { x: 15, y: 28, count: 9, name: "Comfort Inn PDX", fullLocation: "Comfort Inn, Portland OR, Lobby", stainType: "Unknown organic", severity: 3, lastSurveyed: "Jul 2024", notes: "Greenish discoloration near plant stand. Possibly related to overwatering. Possibly not. Fiber sample sent to volunteer lab. Results pending since April. We follow up monthly." }
      ],
      activeTooltip: null,
      tooltipStyle: '',
      selectedCluster: null,

      // Agnes
      questionSent: false,

      // Twins
      twinPairs: [
        {
          swatchA: 'twin-swatch-a', swatchB: 'twin-swatch-b',
          labelA: 'Specimen A', labelB: 'Specimen B',
          locA: "Dr. Whitfield's Dental, Tampa FL",
          locB: 'DMV Branch 4, Reno NV',
          yearA: '1991 | Nylon 6,6', yearB: '1993 | Nylon 6,6',
          fiberA: 'Loop pile', fiberB: 'Loop pile',
          probability: 94.7,
          theories: '"Same sales rep." "Bulk order from the same Carpet Barn going-out-of-business sale." "The universe is a carpet and we are all stains upon it." — mysterystain_OH',
          dividerPos: 50
        },
        {
          swatchA: 'swatch-plaid', swatchB: 'swatch-plaid',
          labelA: 'Specimen A', labelB: 'Specimen B',
          locA: 'VFW Post 1138, Erie PA',
          locB: 'Elk Lodge #207, Duluth MN',
          yearA: '1987 | Wool blend', yearB: '1989 | Wool blend',
          fiberA: 'Cut pile', fiberB: 'Cut pile',
          probability: 88.2,
          theories: '"Fraternal organization group buy, 1986 catalog." "Both ordered by the same guy named Dave." "Dave gets around." — loopqueen99',
          dividerPos: 50
        }
      ],
      dragging: null,

      // Newsletter
      pileSubscribed: false,

      // Date
      currentDate: '',

      init: function() {
        var self = this;
        var d = new Date();
        this.currentDate = d.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

        // Visitor counter tick
        this.counterInterval = setInterval(function() {
          self.tickCounter();
        }, (30 + Math.random() * 60) * 1000);

        // Mouse/touch move for twin slider
        document.addEventListener('mousemove', function(e) { self.onDrag(e); });
        document.addEventListener('mouseup', function() { self.dragging = null; });
        document.addEventListener('touchmove', function(e) { self.onDrag(e); }, { passive: true });
        document.addEventListener('touchend', function() { self.dragging = null; });

        // Scroll reveal
        this.$nextTick(function() {
          self.initReveal();
        });
      },

      initReveal: function() {
        var sections = document.querySelectorAll('.reveal-section');
        if (!sections.length) return;
        var observer = new IntersectionObserver(function(entries) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting) {
              gsap.fromTo(entry.target,
                { clipPath: 'inset(100% 0 0 0)', opacity: 0 },
                { clipPath: 'inset(0% 0 0 0)', opacity: 1, duration: 0.8, ease: 'power2.out' }
              );
              entry.target.classList.add('revealed');
              observer.unobserve(entry.target);
            }
          });
        }, { threshold: 0.1 });
        sections.forEach(function(s) { observer.observe(s); });
      },

      tickCounter: function() {
        var last = parseInt(this.visitorCount[3]);
        var newVal = (last + 1) % 10;
        this.digitFlip = true;
        var self = this;
        setTimeout(function() {
          self.visitorCount[3] = String(newVal);
          self.digitFlip = false;
          // Handle carry
          if (newVal === 0) {
            var mid = parseInt(self.visitorCount[2]);
            self.visitorCount[2] = String((mid + 1) % 10);
            if ((mid + 1) % 10 === 0) {
              var high = parseInt(self.visitorCount[1]);
              self.visitorCount[1] = String((high + 1) % 10);
            }
          }
        }, 400);
      },

      get filteredCards() {
        var self = this;
        return this.allCards.filter(function(c) {
          if (self.filterPattern !== 'all' && c.pattern !== self.filterPattern) return false;
          if (self.filterYear !== 'all' && c.year !== parseInt(self.filterYear)) return false;
          if (self.filterStains === 'low' && c.stains > 10) return false;
          if (self.filterStains === 'med' && (c.stains < 11 || c.stains > 50)) return false;
          if (self.filterStains === 'high' && c.stains < 51) return false;
          if (self.searchKeyword) {
            var kw = self.searchKeyword.toLowerCase();
            var searchable = (c.name + ' ' + c.location + ' ' + c.pattern).toLowerCase();
            if (searchable.indexOf(kw) === -1) return false;
          }
          return true;
        });
      },

      shuffleCards: function() {
        var self = this;
        this.isShuffling = true;
        setTimeout(function() {
          self.isShuffling = false;
        }, 400);
      },

      rateCard: function(card, rating) {
        card.userRating = rating;
        // Simulate community average shift
        card.avgRating = parseFloat(((card.avgRating * 50 + rating) / 51).toFixed(1));
      },

      showTooltip: function(cluster, event) {
        this.activeTooltip = cluster;
        var rect = document.getElementById('stain-map').getBoundingClientRect();
        var x = event.clientX - rect.left + 15;
        var y = event.clientY - rect.top - 10;
        if (x + 200 > rect.width) x = x - 220;
        this.tooltipStyle = 'left:' + x + 'px;top:' + y + 'px';
      },

      hideTooltip: function() {
        this.activeTooltip = null;
      },

      selectCluster: function(cluster) {
        this.selectedCluster = cluster;
        var self = this;
        this.$nextTick(function() {
          var panel = document.getElementById('detail-panel');
          if (panel) panel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        });
      },

      submitQuestion: function() {
        this.questionSent = true;
      },

      subscribePile: function() {
        this.pileSubscribed = true;
      },

      startDrag: function(event, pairIdx) {
        this.dragging = pairIdx;
      },

      onDrag: function(event) {
        if (this.dragging === null) return;
        var pair = this.twinPairs[this.dragging];
        var el = document.querySelector('.twins-pair:nth-of-type(1)');
        // Find the correct pair element
        var pairEls = document.querySelectorAll('.twins-pair');
        if (pairEls[this.dragging]) el = pairEls[this.dragging];
        if (!el) return;
        var rect = el.getBoundingClientRect();
        var clientX = event.clientX || (event.touches && event.touches[0] ? event.touches[0].clientX : 0);
        var pct = ((clientX - rect.left) / rect.width) * 100;
        pct = Math.max(5, Math.min(95, pct));
        pair.dividerPos = pct;
      }
    };
  });
});
</script>
</body>
</html>
