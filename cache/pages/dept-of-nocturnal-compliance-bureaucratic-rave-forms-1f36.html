<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DEPT. OF NOCTURNAL COMPLIANCE — Bureaucratic Rave Forms</title>
<link rel="stylesheet" href="/assets/css/fonts.css">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bone: #F2EDE4;
  --ink: #1A1A1A;
  --gov-green: #2D5A3D;
  --rsvp-red: #C41E3A;
  --field-bg: #E8E2D6;
  --rave-gold: #FFD700;
}

body {
  background: var(--bone);
  color: var(--ink);
  font-family: 'IBM Plex Mono', monospace;
  font-size: 16px;
  line-height: 1.6;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
}

.document-wrapper {
  max-width: 760px;
  margin: 20px auto;
  padding: 24px 20px;
  border: 2px dashed var(--ink);
  background: var(--bone);
  position: relative;
}

@media (max-width: 768px) {
  .document-wrapper {
    margin: 10px 8px;
    padding: 16px 12px;
  }
}

/* ════ TYPOGRAPHY ════ */
h1, h2, h3, .section-heading {
  font-family: 'Oswald', sans-serif;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--ink);
}

.form-number, .ref-code, .disclaimer-text {
  font-family: 'Fira Code', monospace;
}

/* ════ SECTION PARTS ════ */
.form-part {
  border: 1px dotted var(--ink);
  padding: 20px 16px;
  margin: 24px 0;
  position: relative;
}

.section-divider {
  text-align: center;
  font-size: 12px;
  letter-spacing: 2px;
  color: #666;
  margin: 16px 0;
  overflow: hidden;
  white-space: nowrap;
}

.part-label {
  font-family: 'Oswald', sans-serif;
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: var(--gov-green);
  margin-bottom: 12px;
  display: block;
}

/* ════ HEADER ════ */
.dept-header {
  text-align: center;
  padding-bottom: 20px;
  border-bottom: 2px dashed var(--ink);
  margin-bottom: 20px;
}

.dept-seal {
  width: 100px;
  height: 100px;
  border: 3px solid var(--gov-green);
  border-radius: 50%;
  margin: 0 auto 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.dept-seal::before {
  content: '♫ § ♫';
  font-size: 22px;
  color: var(--gov-green);
}

.dept-seal::after {
  content: '';
  position: absolute;
  inset: 4px;
  border: 1px solid var(--gov-green);
  border-radius: 50%;
}

.dept-title {
  font-family: 'Oswald', sans-serif;
  font-size: clamp(18px, 4vw, 28px);
  letter-spacing: 0.08em;
  text-transform: uppercase;
  line-height: 1.3;
  color: var(--ink);
}

.dept-subtitle {
  font-family: 'Oswald', sans-serif;
  font-size: clamp(13px, 2.5vw, 16px);
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--gov-green);
  margin-top: 4px;
}

.urgent-banner {
  background: var(--rsvp-red);
  color: #FFFFFF;
  padding: 10px 16px;
  margin: 16px 0;
  font-family: 'Oswald', sans-serif;
  font-size: clamp(13px, 2.5vw, 16px);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  text-align: center;
  animation: urgentPulse 1.5s ease-in-out infinite;
}

@keyframes urgentPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

.filing-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 12px;
  font-size: 13px;
}

.punch-card {
  display: inline-block;
  width: 28px;
  height: 18px;
  border: 1.5px solid var(--gov-green);
  position: relative;
  animation: spinCard 3s linear infinite;
  vertical-align: middle;
  margin-left: 6px;
}

.punch-card::before {
  content: '● ● ●';
  font-size: 5px;
  position: absolute;
  top: 2px;
  left: 2px;
  color: var(--gov-green);
  letter-spacing: 1px;
}

.punch-card::after {
  content: '● ●';
  font-size: 5px;
  position: absolute;
  bottom: 2px;
  left: 4px;
  color: var(--gov-green);
  letter-spacing: 1px;
}

@keyframes spinCard {
  0% { transform: rotateY(0deg); }
  100% { transform: rotateY(360deg); }
}

/* ════ BRPI THREAT LEVEL ════ */
.threat-meter {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin: 16px 0;
}

.threat-level {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 12px;
  border: 1px solid transparent;
  font-size: 14px;
  transition: all 0.3s ease;
  min-height: 44px;
}

.threat-level.active {
  border: 2px solid var(--ink);
  background: var(--field-bg);
  font-weight: 700;
}

.threat-level .indicator {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 1px solid var(--ink);
  flex-shrink: 0;
  transition: background 0.3s;
}

.threat-level.active .indicator { background: var(--rsvp-red); }

.threat-level:nth-child(1).active .indicator { background: var(--gov-green); }
.threat-level:nth-child(2).active .indicator { background: #7A8B3D; }
.threat-level:nth-child(3).active .indicator { background: var(--rave-gold); }
.threat-level:nth-child(4).active .indicator { background: #D4740E; }
.threat-level:nth-child(5).active .indicator { background: var(--rsvp-red); }

.brpi-timestamp {
  font-size: 12px;
  color: #555;
  margin-top: 8px;
  font-family: 'Fira Code', monospace;
}

.screen-flicker {
  animation: flicker 0.15s ease-in-out;
}

@keyframes flicker {
  0%, 100% { opacity: 1; }
  25% { opacity: 0.7; }
  50% { opacity: 0.9; }
  75% { opacity: 0.75; }
}

/* ════ FORM 303-B ════ */
.form-field {
  margin: 14px 0;
}

.form-field label {
  display: block;
  font-size: 13px;
  margin-bottom: 4px;
  color: var(--ink);
}

.form-field input[type="text"] {
  width: 100%;
  padding: 10px 12px;
  background: var(--field-bg);
  border: 1px solid #999;
  font-family: 'IBM Plex Mono', monospace;
  font-size: 15px;
  color: var(--ink);
  min-height: 44px;
}

.form-field input[type="text"]::placeholder {
  color: #777;
}

.checkbox-line {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  margin: 12px 0;
  cursor: pointer;
  min-height: 44px;
  padding: 4px 0;
}

.checkbox-line input[type="checkbox"] {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
  margin-top: 2px;
  accent-color: var(--gov-green);
  cursor: pointer;
}

.checkbox-line span {
  font-size: 14px;
  line-height: 1.5;
}

.submit-btn {
  display: block;
  width: 100%;
  max-width: 320px;
  margin: 20px auto 0;
  padding: 14px 24px;
  background: var(--gov-green);
  color: #FFFFFF;
  border: none;
  font-family: 'Oswald', sans-serif;
  font-size: 16px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  cursor: pointer;
  min-height: 48px;
  transition: background 0.2s;
}

.submit-btn:hover { background: #1E4029; }
.submit-btn:disabled {
  background: #999;
  cursor: not-allowed;
}

.form-output {
  margin-top: 16px;
  padding: 16px;
  border: 2px dashed var(--ink);
  font-family: 'IBM Plex Mono', monospace;
  font-size: 13px;
  line-height: 1.7;
  white-space: pre-wrap;
  min-height: 60px;
  display: none;
  position: relative;
}

.denied-stamp {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) rotate(-8deg) scale(1);
  font-family: 'Oswald', sans-serif;
  font-size: clamp(32px, 8vw, 52px);
  color: var(--rsvp-red);
  border: 4px solid var(--rsvp-red);
  padding: 4px 20px;
  letter-spacing: 0.15em;
  opacity: 0;
  pointer-events: none;
}

.denied-stamp.stamped {
  animation: stampSlam 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes stampSlam {
  0% { opacity: 0; transform: translate(-50%, -50%) rotate(-15deg) scale(1.5); }
  60% { opacity: 1; transform: translate(-50%, -50%) rotate(-3deg) scale(0.95); }
  100% { opacity: 1; transform: translate(-50%, -50%) rotate(-5deg) scale(1); }
}

/* ════ RAVE OF THE MONTH ════ */
.rave-spotlight {
  background: var(--field-bg);
  border: 3px solid var(--rave-gold);
  padding: 20px 16px;
  position: relative;
  overflow: hidden;
  min-height: 200px;
}

.rave-spotlight::before {
  content: '★ COMMENDATION ★';
  display: block;
  text-align: center;
  font-family: 'Oswald', sans-serif;
  font-size: 12px;
  letter-spacing: 0.2em;
  color: var(--rave-gold);
  margin-bottom: 12px;
}

.rave-card {
  display: none;
}

.rave-card.active {
  display: block;
  animation: paperSlideIn 0.5s ease-out;
}

@keyframes paperSlideIn {
  0% { transform: translateY(40px); opacity: 0; }
  100% { transform: translateY(0); opacity: 1; }
}

.rave-card h3 {
  font-family: 'Oswald', sans-serif;
  font-size: 18px;
  color: var(--gov-green);
  margin-bottom: 8px;
}

.rave-card .permit-status {
  display: inline-block;
  padding: 2px 10px;
  background: var(--gov-green);
  color: #FFFFFF;
  font-family: 'Oswald', sans-serif;
  font-size: 13px;
  letter-spacing: 0.1em;
  margin-bottom: 10px;
}

.rave-detail {
  font-size: 14px;
  margin: 4px 0;
}

.rave-detail strong {
  color: var(--gov-green);
}

/* ════ STAFF DIRECTORY ════ */
.staff-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 16px;
  margin-top: 16px;
}

.staff-badge {
  border: 1px solid var(--ink);
  padding: 16px;
  background: #FFFFFF;
  text-align: center;
}

.staff-portrait {
  width: 64px;
  height: 80px;
  margin: 0 auto 10px;
  border: 1px solid #999;
  background: var(--field-bg);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}

.staff-portrait::before {
  content: '';
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: #CCC;
  position: absolute;
  top: 12px;
}

.staff-portrait::after {
  content: '';
  width: 40px;
  height: 28px;
  border-radius: 50% 50% 0 0;
  background: #CCC;
  position: absolute;
  bottom: 0;
}

.staff-name {
  font-family: 'Oswald', sans-serif;
  font-size: 16px;
  margin-bottom: 2px;
}

.staff-title {
  font-size: 12px;
  color: #555;
  line-height: 1.4;
  margin-bottom: 6px;
}

.staff-years {
  font-family: 'Fira Code', monospace;
  font-size: 11px;
  color: var(--gov-green);
}

/* ════ FAQ ACCORDION ════ */
.faq-item {
  border: 1px dotted #999;
  margin: 12px 0;
}

.faq-question {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 14px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 700;
  min-height: 48px;
  background: var(--field-bg);
  gap: 8px;
  border: none;
  width: 100%;
  text-align: left;
  font-family: 'IBM Plex Mono', monospace;
  color: var(--ink);
}

.faq-question:hover { background: #DDD8CC; }

.faq-toggle {
  font-family: 'Fira Code', monospace;
  font-size: 16px;
  flex-shrink: 0;
  transition: transform 0.2s;
}

.faq-answer {
  padding: 0 14px;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease, padding 0.3s ease;
  font-size: 14px;
  line-height: 1.7;
}

.faq-answer.open {
  padding: 14px;
  max-height: 600px;
}

.faq-answer-inner {
  border-left: 2px solid var(--gov-green);
  padding-left: 12px;
}

/* ════ FOOTER ════ */
.form-footer {
  margin-top: 30px;
  padding-top: 20px;
  border-top: 2px dashed var(--ink);
  text-align: center;
}

.disclaimer-text {
  font-size: 11px;
  color: #555;
  line-height: 1.6;
  max-width: 600px;
  margin: 0 auto;
}

.footer-form-number {
  font-family: 'Fira Code', monospace;
  font-size: 12px;
  color: var(--gov-green);
  margin-top: 12px;
}

.footer-link {
  color: var(--gov-green);
  text-decoration: underline;
  cursor: pointer;
  font-size: 13px;
  display: inline-block;
  margin-top: 8px;
  min-height: 44px;
  line-height: 44px;
  background: none;
  border: none;
  font-family: 'IBM Plex Mono', monospace;
}

.footer-note {
  font-size: 12px;
  color: #666;
  margin-top: 12px;
  font-style: italic;
}

/* ════ DOT MATRIX REVEAL ════ */
.dm-reveal {
  visibility: hidden;
}

.dm-reveal.revealed {
  visibility: visible;
}

/* ════ SCANLINE ════ */
.scanline {
  position: absolute;
  left: 0;
  right: 0;
  height: 2px;
  background: rgba(45, 90, 61, 0.3);
  pointer-events: none;
  z-index: 2;
  display: none;
}

.form-part {
  position: relative;
  overflow: hidden;
}

/* ════ RESPONSIVE ════ */
@media (max-width: 480px) {
  .threat-level { font-size: 13px; padding: 6px 8px; }
  .staff-grid { grid-template-columns: 1fr; }
  .filing-row { flex-direction: column; align-items: flex-start; }
}
</style>
</head>
<body>

<div class="document-wrapper" x-data="brfApp()" x-init="startAll()">

  <!-- ════════════════════════════════════════════ -->
  <!-- HEADER / FILING BANNER -->
  <!-- ════════════════════════════════════════════ -->
  <header class="dept-header">
    <div class="dept-seal"></div>
    <h1 class="dept-title">Department of Nocturnal Compliance</h1>
    <div class="dept-subtitle">Division of Rhythmic Affairs</div>

    <div class="urgent-banner">
      ⚠ URGENT: File Form 419-Ω IMMEDIATELY to maintain compliance with the Interdimensional Accord of Party Sanctioning ⚠
    </div>

    <div class="filing-row">
      <span class="ref-code">REF: DNC/DRA-2018-Ω</span>
      <span>
        Filing Date: <span x-text="todayDate"></span>
        <span class="punch-card"></span>
      </span>
    </div>
  </header>

  <div class="section-divider">════════════════════════════════════════════════════════</div>

  <!-- ════════════════════════════════════════════ -->
  <!-- PART I: BUREAUCRATIC RAVE PREPAREDNESS INDEX -->
  <!-- ════════════════════════════════════════════ -->
  <section class="form-part dm-reveal">
    <span class="part-label">Part I — Bureaucratic Rave Preparedness Index (BRPI)</span>
    <h2 style="font-size:20px; margin-bottom:4px;">Current Threat Assessment</h2>
    <p style="font-size:13px; margin-bottom:14px;">Per Directive 77-Ω §4.1, all jurisdictions must maintain awareness of ambient groove conditions.</p>

    <div class="threat-meter" :class="flickering ? 'screen-flicker' : ''">
      <template x-for="(level, i) in threatLevels" :key="i">
        <div class="threat-level" :class="threatIndex === i ? 'active' : ''">
          <div class="indicator"></div>
          <span x-text="level"></span>
        </div>
      </template>
    </div>

    <div class="brpi-timestamp">
      LAST SCAN: <span x-text="brpiTime"></span> | STATION: NCC-1701-FUNK
    </div>
  </section>

  <div class="section-divider">════════════════════════════════════════════════════════</div>

  <!-- ════════════════════════════════════════════ -->
  <!-- PART II: FORM 303-B -->
  <!-- ════════════════════════════════════════════ -->
  <section class="form-part dm-reveal">
    <span class="part-label">Part II — Form 303-B Supplemental Addendum</span>
    <h2 style="font-size:20px; margin-bottom:4px;">Mandatory Glowstick Disposal Affidavit</h2>
    <p class="ref-code" style="font-size:11px; margin-bottom:16px;">FORM 303-B / REV.12 / PURSUANT TO NOCTURNAL CODE §18.3(g)</p>

    <div class="form-field">
      <label for="rave-name">1. Applicant's Rave Name (legal name optional):</label>
      <input type="text" id="rave-name" placeholder="e.g., DJ Filing Cabinet, The Honorable Bass Drop">
    </div>

    <div class="form-field">
      <label for="rave-freq">2. Primary Frequency of Operation (BPM):</label>
      <input type="text" id="rave-freq" placeholder="e.g., 128, 'whatever the building can handle'">
    </div>

    <p style="font-size:13px; font-weight:700; margin:16px 0 8px;">3. Mandatory Declarations (check all that apply):</p>

    <label class="checkbox-line">
      <input type="checkbox">
      <span>I confirm no glowstick fluid will contact any surface designated as "spiritually neutral" under Zoning Code §42.7</span>
    </label>

    <label class="checkbox-line">
      <input type="checkbox">
      <span>All glowsticks will be decommissioned by a licensed Luminance Disposal Technician (Grade III or above)</span>
    </label>

    <label class="checkbox-line">
      <input type="checkbox">
      <span>I acknowledge that any glowstick lasting longer than four (4) hours constitutes an unauthorized light source under the Permanent Dusk Ordinance</span>
    </label>

    <label class="checkbox-line">
      <input type="checkbox">
      <span>I have read and do not understand the Interdimensional Noise Abatement Appendix (this is the correct response)</span>
    </label>

    <button class="submit-btn" @click="submitForm()" :disabled="formProcessing" x-text="formBtnText">
      SUBMIT FOR REVIEW
    </button>

    <div class="form-output" x-show="formOutputVisible" x-transition style="display:none;">
      <div x-text="formOutputText"></div>
      <div class="denied-stamp" :class="showStamp ? 'stamped' : ''" x-show="showStamp" x-text="'DENIED'"></div>
    </div>
  </section>

  <div class="section-divider">════════════════════════════════════════════════════════</div>

  <!-- ════════════════════════════════════════════ -->
  <!-- PART III: RAVE OF THE MONTH -->
  <!-- ════════════════════════════════════════════ -->
  <section class="form-part dm-reveal">
    <span class="part-label">Part III — Rave of the Month Spotlight</span>
    <h2 style="font-size:20px; margin-bottom:14px;">Interdepartmental Commendation</h2>

    <div class="rave-spotlight">
      <template x-for="(rave, i) in raves" :key="i">
        <div class="rave-card" :class="raveIndex === i ? 'active' : ''">
          <h3 x-text="rave.name"></h3>
          <span class="permit-status" x-text="'PERMIT #' + rave.permit + ' — GRANTED'"></span>
          <p class="rave-detail"><strong>Location:</strong> <span x-text="rave.location"></span></p>
          <p class="rave-detail"><strong>Duration:</strong> <span x-text="rave.duration"></span></p>
          <p class="rave-detail"><strong>Capacity:</strong> <span x-text="rave.capacity"></span></p>
          <p class="rave-detail" style="margin-top:8px; font-style:italic; font-size:13px;" x-text="rave.note"></p>
        </div>
      </template>
    </div>
  </section>

  <div class="section-divider">════════════════════════════════════════════════════════</div>

  <!-- ════════════════════════════════════════════ -->
  <!-- PART IV: STAFF DIRECTORY -->
  <!-- ════════════════════════════════════════════ -->
  <section class="form-part dm-reveal">
    <span class="part-label">Part IV — Staff Directory: Rave Compliance Officers</span>
    <h2 style="font-size:20px; margin-bottom:4px;">Authorized Personnel</h2>
    <p style="font-size:12px; margin-bottom:16px;" class="ref-code">CLEARANCE LEVEL: DISCO-ADJACENT (LEVEL 3)</p>

    <div class="staff-grid">
      <div class="staff-badge">
        <div class="staff-portrait"></div>
        <div class="staff-name">Meredith Quayle-Prentiss</div>
        <div class="staff-title">Senior Synesthesia Auditor</div>
        <div class="staff-years">▸ 14 years of service</div>
      </div>
      <div class="staff-badge">
        <div class="staff-portrait"></div>
        <div class="staff-name">Harold "Bassline" Fenwick</div>
        <div class="staff-title">Deputy Commissioner of Fog Machine Licensing</div>
        <div class="staff-years">▸ 9 years of service</div>
      </div>
      <div class="staff-badge">
        <div class="staff-portrait"></div>
        <div class="staff-name">Constance Okafor-Dinh</div>
        <div class="staff-title">Ambient Noise Parameter Assessor</div>
        <div class="staff-years">▸ 7 years of service</div>
      </div>
      <div class="staff-badge">
        <div class="staff-portrait"></div>
        <div class="staff-name">Terrence Blüthner III</div>
        <div class="staff-title">Chief Archivist, Confiscated Rhythm Section</div>
        <div class="staff-years">▸ 22 years of service</div>
      </div>
    </div>
  </section>

  <div class="section-divider">════════════════════════════════════════════════════════</div>

  <!-- ════════════════════════════════════════════ -->
  <!-- PART V: FAQ (FORM 88-Q) -->
  <!-- ════════════════════════════════════════════ -->
  <section class="form-part dm-reveal">
    <span class="part-label">Part V — Frequently Asked Questions (Form 88-Q)</span>
    <h2 style="font-size:20px; margin-bottom:14px;">Public Inquiry Responses</h2>

    <div class="faq-item">
      <button class="faq-question" @click="toggleFaq(0)">
        <span>Q1: What is the permissible Excessive Bass Resonance Potential (EBRP) for a residential zone?</span>
        <span class="faq-toggle" x-text="faqOpen[0] ? '−' : '+'"></span>
      </button>
      <div class="faq-answer" :class="faqOpen[0] ? 'open' : ''">
        <div class="faq-answer-inner" x-show="faqOpen[0]">
          <span x-text="faqOpen[0] ? faqTexts[0] : ''"></span>
        </div>
      </div>
    </div>

    <div class="faq-item">
      <button class="faq-question" @click="toggleFaq(1)">
        <span>Q2: My permit was denied for "Insufficient Vibrational Intent." What does this mean?</span>
        <span class="faq-toggle" x-text="faqOpen[1] ? '−' : '+'"></span>
      </button>
      <div class="faq-answer" :class="faqOpen[1] ? 'open' : ''">
        <div class="faq-answer-inner" x-show="faqOpen[1]">
          <span x-text="faqOpen[1] ? faqTexts[1] : ''"></span>
        </div>
      </div>
    </div>

    <div class="faq-item">
      <button class="faq-question" @click="toggleFaq(2)">
        <span>Q3: Is it true that Form 419-Ω doesn't actually exist?</span>
        <span class="faq-toggle" x-text="faqOpen[2] ? '−' : '+'"></span>
      </button>
      <div class="faq-answer" :class="faqOpen[2] ? 'open' : ''">
        <div class="faq-answer-inner" x-show="faqOpen[2]">
          <span x-text="faqOpen[2] ? faqTexts[2] : ''"></span>
        </div>
      </div>
    </div>
  </section>

  <div class="section-divider">════════════════════════════════════════════════════════</div>

  <!-- ════════════════════════════════════════════ -->
  <!-- FOOTER -->
  <!-- ════════════════════════════════════════════ -->
  <footer class="form-footer">
    <p class="disclaimer-text">
      TEMPORAL ANOMALY NOTICE: This document may arrive before it was sent. The Department of Nocturnal Compliance accepts no liability for paradoxes, déjà vu, or the sudden conviction that you have been filling out this form for your entire life. By reading this sentence you have agreed to Terms of Service that do not exist yet. All rights reversed. No portion of this document may be understood.
    </p>
    <div class="footer-form-number">BRF-2018-PLUMTREE/FINCH-REV.7</div>
    <button class="footer-link" @click="window.scrollTo({top:0,behavior:'smooth'})">
      ▲ Rave Regulations for Subterranean Ecosystems (R.R.S.E.) — Return to Top
    </button>
    <p class="footer-note">This document was printed on recycled dreams. Please do not fold, spindle, or feel.</p>
  </footer>

</div>

<script src="/assets/js/gsap.min.js"></script>
<script src="/assets/js/alpine.min.js" defer></script>
<script>
document.addEventListener('alpine:init', function() {
  Alpine.data('brfApp', function() {
    return {
      // ─── State ───
      todayDate: '',
      threatIndex: 0,
      threatLevels: [
        'LOW: Ambient Hum',
        'GUARDED: Mild Groove',
        'ELEVATED: Sequins Advisory',
        'HIGH: Unauthorized Funkwave Detected',
        'SEVERE: Full Bureaucratic Collapse'
      ],
      brpiTime: '',
      flickering: false,
      formProcessing: false,
      formBtnText: 'SUBMIT FOR REVIEW',
      formOutputVisible: false,
      formOutputText: '',
      showStamp: false,
      raveIndex: 0,
      raves: [
        {
          name: 'The Algorithmic Ascendance',
          permit: '77-Delta',
          location: 'Sublevel 4, Abandoned Pneumatic Tube Station',
          duration: '11:00 PM – Heat Death of Universe',
          capacity: '137 souls, no more, no fewer',
          note: 'Attendees reported "seeing the shape of their tax returns" during the bass drop. All forms were filed on time.'
        },
        {
          name: 'Quarterly Earnings of the Soul',
          permit: '204-Gamma',
          location: 'Conference Room B (the one with the flickering light)',
          duration: '5:01 PM Friday – Monday Morning Dread',
          capacity: '42 middle managers in various states of release',
          note: 'The spreadsheets started dancing first. Then we all did. HR has been notified. HR was already there.'
        },
        {
          name: 'The Filing Cabinet Requiem',
          permit: '88-Omega',
          location: 'Municipal Archives, Sub-Basement 3 (flooded section)',
          duration: '2:00 AM – Until the toner runs out',
          capacity: 'One person per drawer (four-drawer max occupancy)',
          note: 'Dedicated to every form that was filled out with care and read by no one. The bass was felt in the permits.'
        },
        {
          name: 'Fluorescent Light Vigil',
          permit: '512-Epsilon',
          location: 'Hallway between offices that both claim it isn\'t theirs',
          duration: 'The length of one uncomfortable silence',
          capacity: 'Exactly enough people to make it weird',
          note: 'Not technically a rave. Not technically not a rave. The committee is still deliberating. The music has not stopped.'
        }
      ],
      faqOpen: [false, false, false],
      faqTexts: [
        'Per Regulation 14(c), Excessive Bass Resonance Potential is measured in Fenwick Units (FU), named after Deputy Commissioner Fenwick who insists the naming was accidental. Residential zones permit up to 4.7 FU during standard hours (8 AM – 10 PM) and 0.0 FU at all other times, which is to say: the moment you most want to feel the bass is precisely when it is forbidden. We recognize this is absurd. The regulation stands. Between us, the bass doesn\'t care about zones. It never did. It passes through walls, through permits, through the carefully maintained fiction that sound can be governed. We regulate it anyway, because the alternative is admitting we can\'t control anything, and we\'re not ready for that.',
        'Section 9(a)(ii) of the Rhythmic Intent Assessment requires all applicants to demonstrate "a vibrational sincerity consistent with the spirit of the permit." This is, admittedly, not measurable. Inspectors are trained to detect it intuitively — a kind of bureaucratic gut feeling. If your application was denied, it may mean your paperwork was technically perfect but emotionally vacant. We see this often. The forms were correct. The boxes were checked. But somewhere between Line 4 and Line 5, the joy went missing. Resubmit with feeling. We mean this literally. The form itself should convey that you want to dance, not that you want permission to dance. Those are different things, and the department can tell.',
        'Form 419-Ω is real in the way that a memory of a song you heard once in a parking lot at 3 AM is real. It exists in the registry. It has a number. It has been referenced in seventeen interdepartmental memos. No one has ever seen a blank copy. No one has ever successfully filed one. And yet every six months, someone receives a notice that their 419-Ω is overdue, and they feel a genuine pang of guilt — for a form they never knew about, for a deadline they never agreed to, in a system that may or may not be watching. This is, we believe, the purest form of bureaucracy: obligation without origin. If you figure out how to file it, please let us know. We have been meaning to for years.'
      ],
      denialReasons: [
        'Applicant failed to account for interdimensional noise bleed in Section 4(b)(iii).',
        'Glowstick disposal plan references colors not recognized by this dimension.',
        'Submitted BPM exceeds the Emotional Velocity Threshold for this postal code.',
        'Applicant\'s rave name contains an unregistered vowel sequence.',
        'Form was filled out with sincerity. Sincerity requires Form 77-S (Appendix Feelings).',
        'The Department sensed hesitation between checkboxes 2 and 3. Please recommit.',
        'Vibrational intent was present but faced the wrong cardinal direction.',
        'Applicant\'s aura clashes with existing permit holder in adjacent jurisdiction.'
      ],

      // ─── Init ───
      startAll() {
        var self = this;
        var now = new Date();
        self.todayDate = now.toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
        self.updateBrpiTime();

        // Threat level cycling
        setInterval(function() {
          self.flickering = true;
          setTimeout(function() { self.flickering = false; }, 150);
          self.threatIndex = (self.threatIndex + 1) % self.threatLevels.length;
          self.updateBrpiTime();
        }, 20000);

        // BRPI time tick
        setInterval(function() {
          self.updateBrpiTime();
        }, 5000);

        // Rave rotation
        setInterval(function() {
          self.raveIndex = (self.raveIndex + 1) % self.raves.length;
        }, 12000);

        // Scroll reveals
        self.setupScrollReveals();
      },

      updateBrpiTime() {
        var now = new Date();
        this.brpiTime = now.toLocaleTimeString('en-US', { hour12: false, hour:'2-digit', minute:'2-digit', second:'2-digit' });
      },

      // ─── Form Submission ───
      submitForm() {
        if (this.formProcessing) return;
        var self = this;
        self.formProcessing = true;
        self.formBtnText = 'PROCESSING...';
        self.formOutputVisible = true;
        self.showStamp = false;
        self.formOutputText = '';

        var lines = [
          '> INITIATING FORM 303-B REVIEW PROTOCOL...',
          '> SCANNING CHECKBOXES FOR VIBRATIONAL SINCERITY...',
          '> CROSS-REFERENCING GLOWSTICK REGISTRY (EST. 1974)...',
          '> CONSULTING INTERDIMENSIONAL NOISE ABATEMENT INDEX...',
          '> CALCULATING BUREAUCRATIC RESONANCE QUOTIENT...',
          '> VERDICT RENDERED.'
        ];

        var lineIndex = 0;
        var charIndex = 0;
        var currentText = '';

        function typeNext() {
          if (lineIndex >= lines.length) {
            // Show denial
            var reason = self.denialReasons[Math.floor(Math.random() * self.denialReasons.length)];
            self.formOutputText = currentText + '\n\n═══ DECISION ═══\nSTATUS: DENIED\nREASON: ' + reason;
            self.showStamp = true;
            self.formProcessing = false;
            self.formBtnText = 'SUBMIT FOR REVIEW';
            return;
          }

          var line = lines[lineIndex];
          if (charIndex < line.length) {
            currentText += line[charIndex];
            self.formOutputText = currentText + '█';
            charIndex++;
            setTimeout(typeNext, 30);
          } else {
            currentText += '\n';
            lineIndex++;
            charIndex = 0;
            setTimeout(typeNext, 300);
          }
        }

        setTimeout(typeNext, 500);
      },

      // ─── FAQ ───
      toggleFaq(index) {
        var current = this.faqOpen[index];
        this.faqOpen = [false, false, false];
        if (!current) {
          this.faqOpen[index] = true;
        }
      },

      // ─── Scroll Reveals ───
      setupScrollReveals() {
        var sections = document.querySelectorAll('.dm-reveal');
        if (!sections.length) return;

        var observer = new IntersectionObserver(function(entries) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting && !entry.target.classList.contains('revealed')) {
              entry.target.classList.add('revealed');
              revealSection(entry.target);
            }
          });
        }, { threshold: 0.1 });

        sections.forEach(function(s) { observer.observe(s); });

        function revealSection(el) {
          // Scanline
          var scanline = document.createElement('div');
          scanline.className = 'scanline';
          scanline.style.display = 'block';
          scanline.style.top = '0px';
          el.appendChild(scanline);

          var height = el.offsetHeight;
          gsap.fromTo(scanline,
            { top: 0 },
            { top: height, duration: 0.8, ease: 'none', onComplete: function() {
              scanline.remove();
            }}
          );

          // Reveal heading
          var heading = el.querySelector('h2');
          if (heading) {
            var text = heading.textContent;
            heading.textContent = '';
            heading.style.visibility = 'visible';
            var ci = 0;
            function typeHeading() {
              if (ci < text.length) {
                heading.textContent += text[ci];
                ci++;
                setTimeout(typeHeading, 40);
              }
            }
            typeHeading();
          }
        }
      }
    };
  });
});
</script>

</body>
</html>
