<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Neon Legacy Auction Floor</title>
  <link rel="stylesheet" href="/assets/css/pico.min.css" />
  <link rel="stylesheet" href="/assets/css/fonts.css" />
  <style>
    :root {
      --bruised-navy: #0a0220;
      --clinical-white: #f4f7ff;
      --alarm-yellow: #f0ff13;
      --heartbreak-red: #ff2d5e;
      --midnight-indigo: #1a1a3e;
      --faded-slate: #4a4a6a;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      background: var(--bruised-navy);
      color: var(--clinical-white);
      font-family: "Source Serif 4", serif;
      font-size: 16px;
      line-height: 1.5;
      scroll-behavior: auto;
      overflow-x: hidden;
      cursor: crosshair;
    }

    main {
      width: 100%;
      position: relative;
      padding-bottom: 88px;
    }

    .entrance {
      min-height: 100vh;
      display: grid;
      place-items: center;
      position: relative;
      overflow: hidden;
      padding: 24px;
    }

    .ticker-wrap {
      width: 100%;
      overflow: hidden;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      border-top: 1px solid #f0ff13;
      border-bottom: 1px solid #f0ff13;
      padding: 10px 0;
    }

    .ticker-track {
      display: flex;
      width: max-content;
      animation: tickerLoop 20s linear infinite;
      will-change: transform;
    }

    .ticker-item {
      font-family: "Oswald", sans-serif;
      font-size: clamp(34px, 6vw, 48px);
      letter-spacing: -0.02em;
      text-transform: uppercase;
      color: var(--alarm-yellow);
      white-space: nowrap;
      padding-right: 60px;
      line-height: 1;
    }

    @keyframes tickerLoop {
      from {
        transform: translateX(0);
      }
      to {
        transform: translateX(-50%);
      }
    }

    .entrance-note {
      position: absolute;
      top: calc(50% + 76px);
      left: 50%;
      transform: translateX(-50%);
      margin: 0;
      text-align: center;
      width: min(92vw, 560px);
      font-style: italic;
      font-size: 16px;
      color: var(--clinical-white);
    }

    .scroll-line {
      position: absolute;
      top: calc(50% + 6px);
      left: 50%;
      width: 1px;
      height: calc(50% - 62px);
      background: var(--alarm-yellow);
      transform-origin: top;
      transform: scaleY(0);
      opacity: 0;
    }

    .scroll-line.active {
      animation: drawLine 1.5s ease-out forwards;
    }

    @keyframes drawLine {
      from {
        transform: scaleY(0);
        opacity: 1;
      }
      to {
        transform: scaleY(1);
        opacity: 1;
      }
    }

    .scroll-label {
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      font-family: "Fira Code", monospace;
      font-size: 12px;
      color: var(--alarm-yellow);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      opacity: 0;
    }

    .scroll-label.active {
      opacity: 1;
      animation: pulseLabel 1.4s ease-in-out infinite;
    }

    @keyframes pulseLabel {
      0% {
        opacity: 0.4;
      }
      50% {
        opacity: 1;
      }
      100% {
        opacity: 0.4;
      }
    }

    .manifesto {
      min-height: 60vh;
      display: grid;
      place-items: center;
      padding: 80px 20px 50px;
    }

    .manifesto-box {
      width: min(100%, 680px);
      text-align: center;
    }

    .manifesto .reveal-line {
      opacity: 0;
      transform: translateY(30px);
      font-size: clamp(20px, 2.7vw, 22px);
      margin: 0 0 12px;
      color: var(--clinical-white);
    }

    .manifesto .reveal-line:last-child {
      margin-bottom: 0;
    }

    .live-stats {
      margin-top: 24px;
      font-family: "Fira Code", monospace;
      font-size: 14px;
      color: var(--alarm-yellow);
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .auction-floor {
      padding: 12px 40px 40px;
    }

    .auction-grid {
      display: grid;
      grid-template-columns: 30% 40% 30%;
      gap: 24px;
      align-items: start;
    }

    .auction-card {
      background: var(--midnight-indigo);
      border: 1px solid #f4f7ff;
      padding: 16px;
      position: relative;
      transition: transform 200ms ease, border-color 200ms ease;
      cursor: cell;
      overflow: hidden;
      transform-origin: center;
    }

    .auction-card:hover {
      border-color: var(--alarm-yellow);
    }

    .lot-number {
      margin: 0 0 8px;
      font-family: "Oswald", sans-serif;
      font-size: 12px;
      letter-spacing: -0.02em;
      text-transform: uppercase;
      color: var(--faded-slate);
    }

    .failure-title {
      margin: 0 0 12px;
      font-family: "Oswald", sans-serif;
      font-size: 20px;
      letter-spacing: -0.02em;
      text-transform: uppercase;
      color: var(--clinical-white);
      line-height: 1.15;
    }

    .thumb {
      width: 100%;
      aspect-ratio: 16 / 9;
      border: 1px solid #f4f7ff;
      position: relative;
      margin-bottom: 12px;
      animation: heartbeat var(--pulse-duration, 1s) ease-in-out infinite;
      box-shadow: 0 0 0 0 #ff2d5e;
    }

    @keyframes heartbeat {
      0% {
        box-shadow: 0 0 0 0 #ff2d5e;
      }
      50% {
        box-shadow: 0 0 16px 1px #ff2d5e;
      }
      100% {
        box-shadow: 0 0 0 0 #ff2d5e;
      }
    }

    .bpm {
      position: absolute;
      right: 8px;
      bottom: 6px;
      margin: 0;
      font-family: "Fira Code", monospace;
      font-size: 11px;
      color: var(--heartbreak-red);
      background: #0a0220;
      padding: 2px 4px;
      border: 1px solid #ff2d5e;
    }

    .desc {
      margin: 0 0 12px;
      font-size: 16px;
      color: var(--clinical-white);
    }

    .echo {
      border: 1px dashed #f4f7ff;
      padding: 8px;
      margin-bottom: 14px;
      min-height: 82px;
      background: #0f0a30;
    }

    .echo-head {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .echo-btn {
      border: 0;
      background: transparent;
      color: var(--alarm-yellow);
      font-size: 16px;
      line-height: 1;
      padding: 4px 8px;
      min-width: 44px;
      min-height: 44px;
      font-family: "Fira Code", monospace;
      cursor: pointer;
    }

    .echo-title {
      margin: 0;
      font-family: "Oswald", sans-serif;
      letter-spacing: -0.02em;
      text-transform: uppercase;
      font-size: 11px;
      color: var(--clinical-white);
    }

    .echo-quote {
      margin: 0;
      font-family: "Source Serif 4", serif;
      font-style: italic;
      font-size: 14px;
      color: var(--clinical-white);
      min-height: 44px;
    }

    .echo-text {
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      max-width: 100%;
      vertical-align: top;
    }

    .echo.playing .echo-text {
      max-width: 0;
      animation: typeEcho 3.2s steps(70, end) forwards;
    }

    @keyframes typeEcho {
      from {
        max-width: 0;
      }
      to {
        max-width: 100%;
      }
    }

    .witness {
      display: block;
      margin-top: 6px;
      font-size: 13px;
      color: var(--clinical-white);
    }

    .bid-row {
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 10px;
      align-items: center;
    }

    .current-bid {
      margin: 0;
      font-family: "Fira Code", monospace;
      font-size: 18px;
      color: var(--alarm-yellow);
      line-height: 1;
    }

    .bid-btn {
      border: 1px solid #f0ff13;
      border-radius: 0;
      min-height: 44px;
      padding: 10px 14px;
      background: var(--alarm-yellow);
      color: var(--bruised-navy);
      font-family: "Oswald", sans-serif;
      letter-spacing: -0.02em;
      text-transform: uppercase;
      font-size: 12px;
      cursor: pointer;
      transition: background 120ms ease, color 120ms ease;
    }

    .bid-btn.flash {
      background: var(--heartbreak-red);
      border-color: var(--heartbreak-red);
      color: var(--clinical-white);
    }

    .bid-btn[disabled] {
      background: #36263f;
      border-color: #36263f;
      color: #f4f7ff;
      cursor: not-allowed;
    }

    .time-left {
      margin: 0;
      font-family: "Fira Code", monospace;
      font-size: 12px;
      color: var(--faded-slate);
      text-align: right;
      min-width: 66px;
    }

    .sold-stamp {
      position: absolute;
      top: 46%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-12deg);
      font-family: "Oswald", sans-serif;
      font-size: clamp(30px, 4vw, 36px);
      letter-spacing: -0.02em;
      text-transform: uppercase;
      color: var(--heartbreak-red);
      border: 2px solid #ff2d5e;
      padding: 6px 16px;
      pointer-events: none;
      background: #0a0220;
      opacity: 0.95;
    }

    .shame {
      padding: 72px 20px;
      text-align: center;
    }

    .shame h2 {
      margin: 0;
      font-family: "Oswald", sans-serif;
      font-size: clamp(42px, 9vw, 64px);
      letter-spacing: -0.02em;
      text-transform: uppercase;
      color: var(--clinical-white);
      line-height: 1;
    }

    .shame-sub {
      margin: 12px 0 24px;
      font-style: italic;
      font-size: 16px;
      color: var(--faded-slate);
    }

    .vault-list {
      width: min(900px, 100%);
      margin: 0 auto;
      border-top: 1px solid #f4f7ff;
    }

    .vault-item {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 10px;
      align-items: center;
      text-align: left;
      border-bottom: 1px solid #f4f7ff;
      padding: 12px 10px;
      font-family: "Fira Code", monospace;
      color: var(--clinical-white);
    }

    .vault-item .diamond {
      color: var(--alarm-yellow);
      font-size: 18px;
      line-height: 1;
    }

    .vault-empty {
      font-family: "Fira Code", monospace;
      color: var(--faded-slate);
      text-transform: uppercase;
      font-size: 13px;
      letter-spacing: 0.03em;
      padding: 18px;
      border: 1px dashed #f4f7ff;
      width: min(900px, 100%);
      margin: 0 auto;
    }

    .exit-line {
      min-height: 100vh;
      display: grid;
      place-items: center;
      text-align: center;
      padding: 22px;
    }

    .exit-main {
      margin: 0;
      font-size: clamp(24px, 3.2vw, 28px);
      color: var(--clinical-white);
    }

    .exit-sub {
      margin: 18px 0 0;
      font-family: "Fira Code", monospace;
      font-size: 12px;
      color: var(--alarm-yellow);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      opacity: 0;
      transition: opacity 260ms ease;
    }

    .exit-sub.show {
      opacity: 1;
    }

    .rivalry-bar {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100%;
      background: var(--bruised-navy);
      border-top: 1px solid #f4f7ff;
      padding: 10px 140px 10px 16px;
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 10px;
      z-index: 20;
      min-height: 54px;
    }

    .rivalry-label,
    .session-bids {
      margin: 0;
      font-family: "Oswald", sans-serif;
      text-transform: uppercase;
      letter-spacing: -0.02em;
      font-size: 11px;
      color: var(--faded-slate);
    }

    .session-bids {
      text-align: right;
      font-family: "Fira Code", monospace;
      letter-spacing: 0;
      text-transform: none;
    }

    .tax-value {
      margin: 0;
      font-family: "Fira Code", monospace;
      font-size: 16px;
      color: var(--heartbreak-red);
      text-align: center;
      white-space: nowrap;
    }

    @media (max-width: 1024px) {
      .auction-grid {
        grid-template-columns: 1fr 1fr;
      }

      .rivalry-bar {
        padding-right: 108px;
      }
    }

    @media (max-width: 768px) {
      .auction-floor {
        padding: 12px 14px 36px;
      }

      .auction-grid {
        grid-template-columns: 1fr;
      }

      .bid-row {
        grid-template-columns: 1fr;
        gap: 8px;
      }

      .time-left {
        text-align: left;
      }

      .rivalry-bar {
        grid-template-columns: 1fr;
        gap: 4px;
        padding: 8px 96px 8px 12px;
      }

      .tax-value,
      .session-bids,
      .rivalry-label {
        text-align: left;
      }

      .entrance-note {
        top: calc(50% + 82px);
      }
    }
  </style>
</head>
<body>
  <main x-data="neonLegacyApp()" x-init="init()">
    <section class="entrance" aria-label="Entrance">
      <div class="ticker-wrap" aria-hidden="true">
        <div class="ticker-track">
          <span class="ticker-item">YOU'RE NOT BUYING JUNK — YOU'RE INVESTING IN DEFEAT</span>
          <span class="ticker-item">YOU'RE NOT BUYING JUNK — YOU'RE INVESTING IN DEFEAT</span>
          <span class="ticker-item">YOU'RE NOT BUYING JUNK — YOU'RE INVESTING IN DEFEAT</span>
          <span class="ticker-item">YOU'RE NOT BUYING JUNK — YOU'RE INVESTING IN DEFEAT</span>
        </div>
      </div>
      <p class="entrance-note"><em>Neon Legacy — Est. 2024 by Logan Rhys</em></p>
      <div class="scroll-line" :class="showScrollCue ? 'active' : ''"></div>
      <p class="scroll-label" :class="showScrollCue ? 'active' : ''">SCROLL TO ENTER AUCTION FLOOR ↓</p>
    </section>

    <section class="manifesto" aria-label="Manifesto">
      <div class="manifesto-box">
        <p class="reveal-line">"I won the 2023 US Open because Serena Vasquez's racquet string snapped at match point.</p>
        <p class="reveal-line">Not because I was better.</p>
        <p class="reveal-line">I built Neon Legacy because I needed a place to keep the sound of that string breaking.</p>
        <p class="reveal-line">This is not a trophy case.</p>
        <p class="reveal-line">This is an honest room."</p>

        <p class="live-stats">
          TOTAL FAILURES ARCHIVED: <span x-text="stats.failures.toLocaleString()"></span>
          — ACTIVE BIDS: <span x-text="stats.activeBids.toLocaleString()"></span>
          — RIVALRY TAXES COLLECTED: $<span x-text="formatMillions(stats.taxes)"></span>M
        </p>
      </div>
    </section>

    <section class="auction-floor" aria-label="Auction Floor">
      <div class="auction-grid">
        <template x-for="lot in lots" :key="lot.id">
          <article class="auction-card" :style="cardStyle(lot)">
            <p class="lot-number" x-text="lot.number"></p>
            <h3 class="failure-title" x-text="lot.title"></h3>

            <div class="thumb" :style="`background: ${lot.gradient}; --pulse-duration: ${60 / lot.bpm}s;`">
              <p class="bpm"><span x-text="lot.bpm"></span> BPM</p>
            </div>

            <p class="desc" x-text="lot.description"></p>

            <div class="echo" :class="lot.playing ? 'playing' : ''">
              <div class="echo-head">
                <button class="echo-btn" @click="toggleEcho(lot)" :aria-label="lot.playing ? 'Stop Defeat Echo' : 'Play Defeat Echo'">
                  <span x-text="lot.playing ? '■' : '▶'"></span>
                </button>
                <p class="echo-title">Defeat Echo</p>
              </div>
              <p class="echo-quote">
                <span class="echo-text" x-text="lot.echo"></span>
                <span class="witness" x-text="`— ${lot.witness}`"></span>
              </p>
            </div>

            <div class="bid-row">
              <p class="current-bid">$<span x-text="lot.currentBid.toLocaleString()"></span></p>
              <button
                class="bid-btn"
                :class="lot.flash ? 'flash' : ''"
                :disabled="lot.sold"
                @click="placeBid(lot)"
                x-text="lot.sold ? 'ARCHIVED' : 'BID NOW'"
              ></button>
              <p class="time-left" x-text="lot.sold ? 'CLOSED' : formatTime(lot.timeLeft)"></p>
            </div>

            <div class="sold-stamp" x-show="lot.sold" x-cloak>SOLD</div>
          </article>
        </template>
      </div>
    </section>

    <section class="shame" aria-label="Shame Vault">
      <h2>Shame Vault</h2>
      <p class="shame-sub"><em>Items you've won. They belong to you now.</em></p>

      <div class="vault-empty" x-show="shameVault.length === 0">NO WINS YET. KEEP FEEDING THE FLOOR.</div>

      <div class="vault-list" x-show="shameVault.length > 0">
        <template x-for="entry in shameVault" :key="entry.id">
          <div class="vault-item">
            <span class="diamond">◆</span>
            <span x-text="`${entry.number} — ${entry.title}`"></span>
            <span x-text="`$${entry.bid.toLocaleString()}`"></span>
          </div>
        </template>
      </div>
    </section>

    <section class="exit-line" id="exitLine" aria-label="Exit Line">
      <div>
        <p class="exit-main"><em>You remember her failure. She remembers yours. That's the deal.</em></p>
        <p class="exit-sub" :class="exitVisible ? 'show' : ''">THIS PAGE WILL FORGET EVERYTHING WHEN YOU LEAVE. THE FEELINGS WON'T.</p>
      </div>
    </section>

    <div class="rivalry-bar" aria-label="Rivalry Tax Counter">
      <p class="rivalry-label">YOUR RIVALRY TAX</p>
      <p class="tax-value">$<span x-text="rivalryTax.toLocaleString()"></span></p>
      <p class="session-bids">SESSION BIDS: <span x-text="sessionBids"></span></p>
    </div>
  </main>

  <script src="/assets/js/alpine.min.js" defer></script>
  <script src="/assets/js/gsap.min.js" defer></script>
  <script src="/assets/js/lucide.min.js" defer></script>
  <script>
    function neonLegacyApp() {
      return {
        showScrollCue: false,
        exitVisible: false,
        sessionBids: 0,
        rivalryTax: 0,
        stats: {
          failures: 2847,
          activeBids: 1203,
          taxes: 4.2
        },
        lots: [
          {
            id: 1,
            number: "LOT NL-0047",
            title: "THE NET COLLAPSE — VASQUEZ, 2023",
            description: "Authenticated racquet string fragment. Broke at match point and turned the final into a confession. Kept in inert glass because guilt oxidizes.",
            echo: "\"You could hear it from the nosebleeds. Like a guitar string in a church.\"",
            witness: "Court-side mic operator",
            startBid: 12000,
            currentBid: 12000,
            gradient: "linear-gradient(145deg, #1a1a3e 0%, #0a0220 38%, #ff2d5e 100%)",
            bpm: 72,
            baseBpm: 72,
            timeLeft: 0,
            sold: false,
            flash: false,
            playing: false,
            rotation: "0",
            lastBidder: false,
            wonLogged: false,
            resetBpmTimer: null,
            stopEchoTimer: null
          },
          {
            id: 2,
            number: "LOT NL-0112",
            title: "THE FALSE START — BOLT, 2011",
            description: "Authenticated left shoelace snapped at the knot. Human acceleration outran legal timing by a fraction and the world called it discipline.",
            echo: "\"He knew before the gun. His body left without him.\"",
            witness: "Jamaican team physiotherapist",
            startBid: 8400,
            currentBid: 8400,
            gradient: "linear-gradient(125deg, #0a0220 0%, #1a1a3e 52%, #f0ff13 100%)",
            bpm: 80,
            baseBpm: 80,
            timeLeft: 0,
            sold: false,
            flash: false,
            playing: false,
            rotation: "0",
            lastBidder: false,
            wonLogged: false,
            resetBpmTimer: null,
            stopEchoTimer: null
          },
          {
            id: 3,
            number: "LOT NL-0201",
            title: "THE BRICK HEARD ROUND THE WORLD — O'NEAL, 1995",
            description: "Headband, sweat-authenticated. The free throw hit nothing but silence. Fabric still holds a salt map of regret.",
            echo: "\"The rim didn't even move. That's how you know.\"",
            witness: "Arena janitor, off-record",
            startBid: 2500,
            currentBid: 2500,
            gradient: "linear-gradient(160deg, #1a1a3e 0%, #4a4a6a 40%, #0a0220 100%)",
            bpm: 68,
            baseBpm: 68,
            timeLeft: 0,
            sold: false,
            flash: false,
            playing: false,
            rotation: "0",
            lastBidder: false,
            wonLogged: false,
            resetBpmTimer: null,
            stopEchoTimer: null
          },
          {
            id: 4,
            number: "LOT NL-0319",
            title: "THE JAVELIN WHISPER — TRIALS, 1988",
            description: "Authenticated tip fragment from a splintered release. It flew three meters and one lifetime. Catalogued under mechanical tragedy.",
            echo: "\"It made this sound like a pencil breaking underwater.\"",
            witness: "Coach, recovered tape",
            startBid: 5000,
            currentBid: 5000,
            gradient: "linear-gradient(135deg, #0a0220 0%, #1a1a3e 45%, #ff2d5e 95%)",
            bpm: 89,
            baseBpm: 89,
            timeLeft: 0,
            sold: false,
            flash: false,
            playing: false,
            rotation: "0",
            lastBidder: false,
            wonLogged: false,
            resetBpmTimer: null,
            stopEchoTimer: null
          },
          {
            id: 5,
            number: "LOT NL-0408",
            title: "MILE 26 COLLAPSE — ORTIZ, 2022",
            description: "Authenticated right shoe insert, deformed from cramping. The final mile got billed as character. It was physiology with witnesses.",
            echo: "\"His face didn't change. That's the worst part. He just stopped.\"",
            witness: "Volunteer medic",
            startBid: 1800,
            currentBid: 1800,
            gradient: "linear-gradient(150deg, #1a1a3e 0%, #0a0220 55%, #f0ff13 100%)",
            bpm: 76,
            baseBpm: 76,
            timeLeft: 0,
            sold: false,
            flash: false,
            playing: false,
            rotation: "0",
            lastBidder: false,
            wonLogged: false,
            resetBpmTimer: null,
            stopEchoTimer: null
          },
          {
            id: 6,
            number: "LOT NL-0526",
            title: "THE DOUBLE FAULT HEARD NOWHERE — PROKOVA, 2019",
            description: "Ball fuzz sample, authenticated. Match point landed in the net and the silence got archived before the score did.",
            echo: "\"The crowd was so quiet I heard her whisper something in Russian. I don't speak Russian.\"",
            witness: "Line judge",
            startBid: 3200,
            currentBid: 3200,
            gradient: "linear-gradient(140deg, #0a0220 0%, #1a1a3e 40%, #4a4a6a 100%)",
            bpm: 64,
            baseBpm: 64,
            timeLeft: 0,
            sold: false,
            flash: false,
            playing: false,
            rotation: "0",
            lastBidder: false,
            wonLogged: false,
            resetBpmTimer: null,
            stopEchoTimer: null
          },
          {
            id: 7,
            number: "LOT NL-0670",
            title: "THE DROPPED BATON — US 4X100M, 2008",
            description: "Authenticated grip tape residue on glass slide. Four careers compressed into one missed transfer and a very light piece of aluminum.",
            echo: "\"Four people's dreams on a piece of aluminum. It's actually very light.\"",
            witness: "Olympic museum curator",
            startBid: 6700,
            currentBid: 6700,
            gradient: "linear-gradient(155deg, #1a1a3e 0%, #ff2d5e 48%, #0a0220 100%)",
            bpm: 92,
            baseBpm: 92,
            timeLeft: 0,
            sold: false,
            flash: false,
            playing: false,
            rotation: "0",
            lastBidder: false,
            wonLogged: false,
            resetBpmTimer: null,
            stopEchoTimer: null
          }
        ],
        shameVault: [],
        isMobile: false,
        countdownTimer: null,
        statTimer: null,
        exitObserver: null,

        init() {
          this.isMobile = window.matchMedia("(max-width: 768px)").matches;
          this.rivalryTax = this.readRivalryTax();

          this.lots.forEach((lot) => {
            lot.currentBid = lot.startBid;
            lot.baseBpm = this.randomInt(62, 95);
            lot.bpm = lot.baseBpm;
            lot.timeLeft = this.randomInt(45 * 60, 4 * 60 * 60);
            lot.rotation = (Math.random() * 2 - 1).toFixed(2);
          });

          this.countdownTimer = window.setInterval(() => {
            this.tickLots();
          }, 1000);

          this.scheduleStatTick();

          window.setTimeout(() => {
            this.showScrollCue = true;
          }, 3000);

          this.setupManifestoReveal();
          this.setupExitReveal();

          window.addEventListener("resize", () => {
            this.isMobile = window.matchMedia("(max-width: 768px)").matches;
          });

          window.setTimeout(() => {
            if (window.lucide && typeof window.lucide.createIcons === "function") {
              window.lucide.createIcons();
            }
          }, 0);
        },

        readRivalryTax() {
          try {
            var raw = window.localStorage.getItem("rivalryTax");
            var n = raw ? parseInt(raw, 10) : 0;
            return Number.isFinite(n) && n > 0 ? n : 0;
          } catch (err) {
            return 0;
          }
        },

        saveRivalryTax() {
          try {
            window.localStorage.setItem("rivalryTax", String(this.rivalryTax));
          } catch (err) {
            /* ignore storage issues */
          }
        },

        scheduleStatTick() {
          var delay = this.randomInt(2000, 8000);
          this.statTimer = window.setTimeout(() => {
            this.stats.failures += this.randomInt(1, 4);
            this.stats.activeBids += this.randomInt(2, 11);
            this.stats.taxes = +(this.stats.taxes + (Math.random() * 0.06 + 0.01)).toFixed(2);
            this.scheduleStatTick();
          }, delay);
        },

        setupManifestoReveal() {
          var lines = document.querySelectorAll(".manifesto .reveal-line");
          if (!lines.length) return;

          if (window.gsap && window.ScrollTrigger) {
            window.gsap.registerPlugin(window.ScrollTrigger);
            window.gsap.fromTo(
              ".manifesto .reveal-line",
              { opacity: 0, y: 30 },
              {
                opacity: 1,
                y: 0,
                duration: 0.7,
                stagger: 0.1,
                ease: "power2.out",
                scrollTrigger: {
                  trigger: ".manifesto",
                  start: "top 75%",
                  once: true
                }
              }
            );
            return;
          }

          var observer = new IntersectionObserver(
            (entries, obs) => {
              entries.forEach((entry) => {
                if (entry.isIntersecting) {
                  if (window.gsap) {
                    window.gsap.fromTo(
                      ".manifesto .reveal-line",
                      { opacity: 0, y: 30 },
                      { opacity: 1, y: 0, duration: 0.7, stagger: 0.1, ease: "power2.out" }
                    );
                  } else {
                    lines.forEach((line, idx) => {
                      window.setTimeout(() => {
                        line.style.opacity = "1";
                        line.style.transform = "translateY(0)";
                        line.style.transition = "opacity 0.4s ease, transform 0.4s ease";
                      }, idx * 100);
                    });
                  }
                  obs.disconnect();
                }
              });
            },
            { threshold: 0.25 }
          );

          var block = document.querySelector(".manifesto");
          if (block) observer.observe(block);
        },

        setupExitReveal() {
          var target = document.getElementById("exitLine");
          if (!target) return;

          this.exitObserver = new IntersectionObserver(
            (entries, obs) => {
              entries.forEach((entry) => {
                if (entry.isIntersecting) {
                  window.setTimeout(() => {
                    this.exitVisible = true;
                  }, 5000);
                  obs.disconnect();
                }
              });
            },
            { threshold: 0.55 }
          );

          this.exitObserver.observe(target);
        },

        formatMillions(value) {
          return value.toFixed(2);
        },

        randomInt(min, max) {
          return Math.floor(Math.random() * (max - min + 1)) + min;
        },

        cardStyle(lot) {
          var rotate = this.isMobile ? 0 : lot.rotation;
          return "transform: rotate(" + rotate + "deg);";
        },

        formatTime(seconds) {
          var s = Math.max(0, seconds);
          var h = Math.floor(s / 3600);
          var m = Math.floor((s % 3600) / 60);
          return h + "h " + String(m).padStart(2, "0") + "m";
        },

        toggleEcho(lot) {
          lot.playing = !lot.playing;
          if (lot.stopEchoTimer) {
            window.clearTimeout(lot.stopEchoTimer);
            lot.stopEchoTimer = null;
          }
          if (lot.playing) {
            lot.stopEchoTimer = window.setTimeout(() => {
              lot.playing = false;
              lot.stopEchoTimer = null;
            }, 4000);
          }
        },

        placeBid(lot) {
          if (lot.sold) return;

          var increment = this.randomInt(1, 10) * 50;
          lot.currentBid += increment;
          lot.lastBidder = true;
          this.sessionBids += 1;

          this.rivalryTax += increment;
          this.saveRivalryTax();

          lot.flash = true;
          window.setTimeout(() => {
            lot.flash = false;
          }, 260);

          var bpmBoost = this.randomInt(3, 8);
          lot.bpm = lot.baseBpm + bpmBoost;

          if (lot.resetBpmTimer) {
            window.clearTimeout(lot.resetBpmTimer);
            lot.resetBpmTimer = null;
          }

          lot.resetBpmTimer = window.setTimeout(() => {
            lot.bpm = lot.baseBpm;
            lot.resetBpmTimer = null;
          }, 10000);
        },

        tickLots() {
          this.lots.forEach((lot) => {
            if (lot.sold) return;

            lot.timeLeft -= 1;
            if (lot.timeLeft <= 0) {
              lot.timeLeft = 0;
              lot.sold = true;

              if (lot.lastBidder && !lot.wonLogged) {
                this.shameVault.push({
                  id: "vault-" + lot.id + "-" + Date.now(),
                  number: lot.number,
                  title: lot.title,
                  bid: lot.currentBid
                });
                lot.wonLogged = true;
              }
            }
          });
        }
      };
    }
  </script>
</body>
</html>
