<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solemn Sympathy Service — Your Frustration Is Not Trivial</title>
<link rel="stylesheet" href="/assets/css/fonts.css">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --green: #9CBC9C;
  --midnight: #2C3340;
  --brick: #B45F5D;
  --orange: #FF9900;
  --paper: #D4CFC4;
  --void: #1A1D23;
}

html { scroll-behavior: smooth; }

body {
  font-family: 'Fira Code', monospace;
  font-size: 16px;
  line-height: 1.7;
  color: var(--green);
  background: var(--void);
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* --- SECTION DIVIDERS --- */
.divider {
  text-align: center;
  color: var(--green);
  opacity: 0.4;
  padding: 2rem 0;
  font-size: 14px;
  letter-spacing: 6px;
  user-select: none;
}

/* --- SECTION 1: THE SIGNAL --- */
.signal {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--void);
  padding: 2rem 1rem;
  position: relative;
}

.cursor-blink {
  display: inline-block;
  width: 10px;
  height: 1.2em;
  background: var(--green);
  animation: blink 1.2s step-end infinite;
  vertical-align: middle;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}

.signal-header {
  text-align: center;
  min-height: 120px;
}

.signal-title {
  font-family: 'DM Serif Display', serif;
  font-size: clamp(1.8rem, 5vw, 3rem);
  color: var(--green);
  letter-spacing: 2px;
  margin-bottom: 0.25rem;
}

.signal-sub {
  font-size: clamp(12px, 2vw, 14px);
  color: var(--green);
  opacity: 0.7;
  line-height: 1.8;
}

.signal-motto {
  margin-top: 2rem;
  font-size: clamp(14px, 2.5vw, 16px);
  color: var(--paper);
  font-style: italic;
  text-align: center;
}

.signal-line {
  width: 200px;
  height: 1px;
  background: var(--brick);
  margin: 1.5rem auto;
}

/* Walkie-talkie button */
.comms-btn {
  font-family: 'Fira Code', monospace;
  font-size: 14px;
  background: transparent;
  color: var(--green);
  border: 1px solid var(--green);
  padding: 12px 24px;
  cursor: pointer;
  letter-spacing: 2px;
  transition: border-color 0.3s, color 0.3s;
  min-height: 48px;
  min-width: 280px;
}

.comms-btn.active {
  color: var(--brick);
  border-color: var(--brick);
  animation: pulse-border 1.5s ease-in-out infinite;
}

@keyframes pulse-border {
  0%, 100% { border-color: var(--brick); box-shadow: 0 0 0 0 rgba(180,95,93,0.4); }
  50% { border-color: var(--orange); box-shadow: 0 0 12px 2px rgba(180,95,93,0.2); }
}

.contemplation {
  margin-top: 1.5rem;
  text-align: center;
  font-size: 14px;
  color: var(--brick);
  letter-spacing: 1px;
}

.silence-note {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  font-family: 'Caveat', cursive;
  font-size: clamp(18px, 3vw, 24px);
  color: var(--paper);
  opacity: 0;
  transition: opacity 1.5s ease;
  pointer-events: none;
  z-index: 100;
  text-align: center;
  padding: 0 1rem;
}

.silence-note.visible { opacity: 0.92; }

/* --- SECTION 2: ABOUT --- */
.about {
  background: var(--midnight);
  padding: 4rem 1.5rem;
  position: relative;
}

.about::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background:
    linear-gradient(135deg, transparent 48%, rgba(156,188,156,0.03) 49%, rgba(156,188,156,0.03) 51%, transparent 52%),
    linear-gradient(45deg, transparent 48%, rgba(156,188,156,0.03) 49%, rgba(156,188,156,0.03) 51%, transparent 52%);
  background-size: 60px 60px;
  pointer-events: none;
}

.memo {
  max-width: 580px;
  margin: 0 auto;
  position: relative;
}

.memo-header {
  font-size: clamp(12px, 2vw, 14px);
  color: var(--green);
  margin-bottom: 1.5rem;
  line-height: 2;
  border-bottom: 1px solid rgba(156,188,156,0.2);
  padding-bottom: 1rem;
}

.memo-header span { color: var(--paper); }

.memo-body {
  font-size: clamp(14px, 2.5vw, 15px);
  color: var(--paper);
  line-height: 1.9;
}

.memo-body p { margin-bottom: 1.2rem; }

.memo-list {
  color: var(--green);
  margin: 1rem 0 1.5rem 0;
  list-style: none;
}

.memo-list li::before {
  content: '▸ ';
  color: var(--brick);
}

.memo-list li {
  margin-bottom: 0.4rem;
  font-size: clamp(13px, 2vw, 14px);
}

.memo-fine {
  font-size: clamp(12px, 2vw, 13px);
  color: var(--green);
  opacity: 0.8;
  border-top: 1px solid rgba(156,188,156,0.15);
  padding-top: 1rem;
  margin-top: 1.5rem;
  line-height: 2;
}

/* Caveat annotations */
.annotation {
  font-family: 'Caveat', cursive;
  color: var(--brick);
  font-size: clamp(16px, 3vw, 20px);
  position: absolute;
  opacity: 0;
  transition: opacity 1.5s ease;
  pointer-events: none;
  white-space: nowrap;
}

.annotation.visible { opacity: 0.92; }

.annotation-memo {
  right: -220px;
  top: 60px;
  transform: rotate(-3deg);
  max-width: 200px;
  white-space: normal;
}

@media (max-width: 900px) {
  .annotation-memo {
    position: relative;
    right: auto;
    top: auto;
    transform: rotate(-1deg);
    margin-top: 1.5rem;
    text-align: right;
  }
}

/* --- SECTION 3: FORM --- */
.form-section {
  background: var(--paper);
  padding: 3rem 1.5rem;
  position: relative;
}

.form-section::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background-image: radial-gradient(circle, rgba(44,51,64,0.06) 1px, transparent 1px);
  background-size: 16px 16px;
  pointer-events: none;
}

.form-wrap {
  max-width: 560px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

.form-title {
  font-size: clamp(14px, 2.5vw, 16px);
  color: var(--midnight);
  font-weight: 700;
  letter-spacing: 1px;
  margin-bottom: 0.5rem;
  border-bottom: 2px solid var(--midnight);
  padding-bottom: 0.5rem;
}

.form-subtitle {
  font-size: 12px;
  color: var(--midnight);
  opacity: 0.6;
  margin-bottom: 2rem;
}

.field {
  margin-bottom: 1.5rem;
}

.field label {
  display: block;
  font-size: 13px;
  color: var(--midnight);
  font-weight: 700;
  letter-spacing: 1px;
  margin-bottom: 0.4rem;
}

.field input[type="text"],
.field textarea {
  font-family: 'Fira Code', monospace;
  font-size: 14px;
  width: 100%;
  padding: 10px 12px;
  background: rgba(156,188,156,0.15);
  border: 1px solid var(--midnight);
  color: var(--midnight);
  outline: none;
  transition: border-color 0.2s;
}

.field input[type="text"]:focus,
.field textarea:focus {
  border-color: var(--brick);
}

.field textarea { resize: vertical; }

/* Win95 select */
.win95-select {
  font-family: 'Fira Code', monospace;
  font-size: 13px;
  width: 100%;
  padding: 8px 10px;
  background: #C0C0C0;
  color: #000000;
  border: 2px outset #FFFFFF;
  outline: none;
  cursor: pointer;
  appearance: none;
  -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpolygon points='0,0 12,0 6,8' fill='%23000'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  padding-right: 30px;
}

.win95-select:active { border-style: inset; }

/* Radio buttons */
.radio-group {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  margin-top: 0.5rem;
}

.radio-label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  font-size: 12px;
  color: var(--midnight);
  letter-spacing: 0.5px;
  min-height: 44px;
  padding: 4px 8px;
}

.radio-label input[type="radio"] {
  appearance: none;
  -webkit-appearance: none;
  width: 20px;
  height: 20px;
  border: 2px solid var(--midnight);
  background: #C0C0C0;
  cursor: pointer;
  flex-shrink: 0;
  position: relative;
}

.radio-label input[type="radio"]:checked {
  background: var(--midnight);
}

.radio-label input[type="radio"]:checked::after {
  content: '';
  position: absolute;
  top: 4px; left: 4px;
  width: 8px; height: 8px;
  background: var(--green);
}

/* Submit */
.submit-btn {
  font-family: 'Fira Code', monospace;
  font-size: 13px;
  background: var(--midnight);
  color: var(--green);
  border: 1px solid var(--green);
  padding: 14px 24px;
  cursor: pointer;
  letter-spacing: 1px;
  width: 100%;
  min-height: 48px;
  transition: background 0.2s, color 0.2s;
  margin-top: 0.5rem;
}

.submit-btn:hover {
  background: var(--brick);
  color: var(--paper);
}

/* --- HOLD SEQUENCE --- */
.hold-screen {
  background: var(--void);
  padding: 3rem 1.5rem;
  text-align: center;
  min-height: 400px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.hold-title {
  font-size: clamp(14px, 2.5vw, 16px);
  color: var(--green);
  letter-spacing: 2px;
  margin-bottom: 0.5rem;
}

.hold-sub {
  font-size: 13px;
  color: var(--paper);
  opacity: 0.7;
  margin-bottom: 0.5rem;
}

.hold-please {
  font-size: clamp(16px, 3vw, 20px);
  color: var(--brick);
  letter-spacing: 4px;
  margin: 1rem 0;
}

.progress-bar {
  width: 100%;
  max-width: 400px;
  height: 24px;
  background: var(--midnight);
  border: 1px solid var(--green);
  margin: 1.5rem auto;
  position: relative;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--green);
  width: 0%;
  transition: width 1s linear;
}

.progress-label {
  font-size: 11px;
  color: var(--green);
  opacity: 0.6;
  margin-bottom: 1.5rem;
}

.operator-notes {
  text-align: left;
  max-width: 500px;
  margin: 0 auto;
  font-size: clamp(12px, 2vw, 13px);
  color: var(--green);
  line-height: 2.2;
}

.operator-notes .note-line {
  opacity: 0.8;
}

/* Resolution card */
.resolution {
  background: var(--paper);
  max-width: 480px;
  margin: 2rem auto;
  padding: 2rem;
  border: 1px solid var(--midnight);
  text-align: center;
  color: var(--midnight);
}

.resolution h3 {
  font-size: 15px;
  letter-spacing: 2px;
  margin-bottom: 1rem;
  color: var(--midnight);
}

.resolution p {
  font-size: 14px;
  line-height: 1.8;
  margin-bottom: 1rem;
  color: var(--midnight);
}

.resolution .sign-off {
  font-size: 13px;
  opacity: 0.7;
  line-height: 1.8;
  color: var(--midnight);
}

.copy-btn {
  font-family: 'Fira Code', monospace;
  font-size: 12px;
  background: var(--midnight);
  color: var(--green);
  border: 1px solid var(--green);
  padding: 8px 16px;
  cursor: pointer;
  letter-spacing: 1px;
  min-height: 44px;
  margin-top: 0.5rem;
  transition: background 0.2s;
}

.copy-btn:hover { background: var(--brick); }

/* --- SECTION 4: TESTIMONIALS --- */
.testimonials {
  background: var(--midnight);
  padding: 4rem 1.5rem;
  position: relative;
}

.test-header {
  text-align: center;
  font-size: clamp(13px, 2vw, 15px);
  color: var(--green);
  letter-spacing: 3px;
  margin-bottom: 3rem;
  opacity: 0.6;
}

.test-grid {
  max-width: 700px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.test-card {
  background: var(--paper);
  border: 1px solid var(--green);
  padding: 1.5rem;
  box-shadow: 4px 4px 0 rgba(0,0,0,0.15);
  position: relative;
}

.test-redacted {
  font-size: 11px;
  color: var(--midnight);
  filter: blur(3px);
  margin-bottom: 1rem;
  line-height: 1.6;
  user-select: none;
}

.test-body {
  font-size: clamp(13px, 2vw, 14px);
  color: var(--midnight);
  line-height: 1.8;
  font-style: italic;
}

.test-case {
  font-size: 12px;
  color: var(--midnight);
  opacity: 0.5;
  margin-top: 0.75rem;
  font-style: normal;
}

.annotation-ruth {
  right: -180px;
  bottom: 10px;
  transform: rotate(-2deg);
  max-width: 180px;
  white-space: normal;
}

@media (max-width: 900px) {
  .annotation-ruth {
    position: relative;
    right: auto;
    bottom: auto;
    transform: rotate(-1deg);
    margin-top: 1rem;
    text-align: right;
  }
}

/* --- SECTION 5: THE ADVERSARY --- */
.adversary {
  background: var(--midnight);
  padding: 4rem 1.5rem;
  position: relative;
}

.adversary-flash {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: var(--orange);
  opacity: 0;
  pointer-events: none;
  z-index: 2;
}

.adversary-inner {
  max-width: 580px;
  margin: 0 auto;
  position: relative;
  z-index: 3;
}

.adversary-title {
  font-size: clamp(12px, 2vw, 14px);
  color: var(--green);
  letter-spacing: 3px;
  margin-bottom: 2rem;
  opacity: 0.5;
}

.adversary p {
  font-size: clamp(14px, 2.5vw, 15px);
  color: var(--paper);
  line-height: 1.9;
  margin-bottom: 1.2rem;
}

.happy-queue {
  color: var(--orange);
  font-size: 1.1em;
  display: inline-block;
  animation: hq-bounce 3s ease-in-out infinite;
}

@keyframes hq-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-2px); }
}

.adversary .still-here {
  color: var(--green);
  font-weight: 700;
}

/* --- SECTION 6: SIGN-OFF --- */
.signoff {
  background: var(--void);
  padding: 5rem 1.5rem;
  text-align: center;
  min-height: 80vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.signoff-title {
  font-family: 'DM Serif Display', serif;
  font-size: clamp(1.4rem, 4vw, 2rem);
  color: var(--green);
  letter-spacing: 2px;
  margin-bottom: 0.5rem;
}

.signoff-info {
  font-size: clamp(12px, 2vw, 13px);
  color: var(--green);
  opacity: 0.6;
  line-height: 2;
  margin-bottom: 2rem;
}

.signoff-quote {
  font-size: clamp(14px, 2.5vw, 16px);
  color: var(--paper);
  line-height: 1.9;
  max-width: 440px;
  margin: 0 auto 1rem auto;
  font-style: italic;
}

.signoff-attr {
  font-size: 14px;
  color: var(--green);
  opacity: 0.5;
  margin-bottom: 3rem;
}

.signoff-end {
  font-size: 13px;
  color: var(--green);
  opacity: 0.3;
  letter-spacing: 6px;
  margin-top: 3rem;
}

/* Channel input */
.channel-input-wrap {
  margin-top: 2.5rem;
  max-width: 400px;
  width: 100%;
}

.channel-label {
  font-size: 12px;
  color: var(--green);
  opacity: 0.5;
  letter-spacing: 1px;
  margin-bottom: 0.5rem;
  display: block;
}

.channel-input {
  font-family: 'Fira Code', monospace;
  font-size: 14px;
  width: 100%;
  padding: 12px;
  background: transparent;
  border: 1px solid rgba(156,188,156,0.3);
  color: var(--green);
  outline: none;
  text-align: center;
  min-height: 48px;
}

.channel-input:focus {
  border-color: var(--green);
}

.channel-response {
  font-size: 14px;
  color: var(--brick);
  margin-top: 1rem;
  letter-spacing: 1px;
}

.channel-memory {
  font-size: 13px;
  color: var(--green);
  opacity: 0.6;
  font-style: italic;
}

/* --- RAIN SMEAR EFFECT --- */
.rain-cursor {
  position: fixed;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(156,188,156,0.04) 0%, transparent 70%);
  pointer-events: none;
  z-index: 9999;
  transform: translate(-50%, -50%);
  backdrop-filter: blur(0.5px);
  -webkit-backdrop-filter: blur(0.5px);
  display: none;
}

/* --- RESPONSIVE --- */
@media (max-width: 768px) {
  .comms-btn { min-width: 240px; font-size: 12px; }
  .memo { padding: 0 0.5rem; }
  .form-wrap { padding: 0 0.5rem; }
}

@media (max-width: 375px) {
  body { font-size: 16px; }
  .signal-title { font-size: 1.6rem; }
  .radio-group { flex-direction: column; }
}
</style>
</head>
<body>
<div class="rain-cursor" id="rainCursor"></div>
<div class="silence-note" id="silenceNote">Silence is the first honest thing you can offer.</div>

<!-- ═══ SECTION 1: THE SIGNAL ═══ -->
<section class="signal" x-data="signal()" x-init="startTyping()">
  <div class="signal-header">
    <div x-show="!typingDone" style="min-height: 120px; display: flex; align-items: center; justify-content: center;">
      <span x-text="typedText" style="white-space: pre-wrap; text-align: center; display: inline;"></span><span class="cursor-blink" x-show="!typingDone"></span>
    </div>
    <div x-show="typingDone" x-cloak>
      <div class="signal-title">SOLEMN SYMPATHY SERVICE</div>
      <div class="signal-sub">
        est. 2015 — Cincinnati, OH<br>
        Operator on Duty: <span style="color: var(--paper);">Lawrence "Low" Grissom</span>
      </div>
    </div>
  </div>

  <div class="signal-motto" x-show="typingDone" x-cloak>"Your frustration is not trivial."</div>
  <div class="signal-line" x-show="typingDone" x-cloak></div>

  <button class="comms-btn"
    :class="{ active: commsActive }"
    @click="toggleComms()"
    x-show="typingDone" x-cloak
    :disabled="commsActive"
    x-text="commsActive ? 'COMMS STATUS: ACTIVE' : 'COMMS STATUS: IDLE'">
  </button>

  <div class="contemplation" x-show="commsActive" x-cloak>
    CONTEMPLATION PERIOD: <span x-text="countdownStr"></span>
  </div>
</section>

<div class="divider">· · · · · · · · · · · · · · ·</div>

<!-- ═══ SECTION 2: ABOUT THE SERVICE ═══ -->
<section class="about">
  <div class="memo">
    <div class="memo-header">
      MEMO: RE: What We Do<br>
      FROM: <span>L. Grissom, Chief Sympathy Operator</span><br>
      DATE: Ongoing<br>
      PRIORITY: <span>Yours</span>
    </div>
    <div class="memo-body">
      <p>The Solemn Sympathy Service provides genuine technical and emotional support for the small indignities nobody takes seriously.</p>
      <ul class="memo-list">
        <li>The paper jam that ruins your morning.</li>
        <li>The sock that never dries.</li>
        <li>The microwave that beeps like it owns you.</li>
        <li>The update that restarts without asking.</li>
        <li>The hold music that assumes you have nowhere else to be.</li>
      </ul>
      <p>We do not fix these things. We cannot.</p>
      <p>What we do is stop what we are doing, and sit with you. We use walkie-talkie protocol because a walkie-talkie requires you to stop talking before someone else can start. That is the entire technology of listening.</p>
    </div>
    <div class="memo-fine">
      Processing time: 5 minutes minimum.<br>
      Processing fee: $4.99 (emotional vector analysis).<br>
      Refund policy: Your frustration was real. No refunds.
    </div>
    <div class="annotation annotation-memo" data-annotation>I wrote this at 3:07 AM. The microwave beeped four times. —L</div>
  </div>
</section>

<div class="divider">· · · · · · · · · · · · · · ·</div>

<!-- ═══ SECTION 3: DISTURBANCE REPORT FORM ═══ -->
<section class="form-section" x-data="disturbanceForm()">
  <div class="form-wrap">
    <!-- THE FORM -->
    <div x-show="state === 'form'">
      <div class="form-title">FORM SSS-01: DISTURBANCE REPORT</div>
      <div class="form-subtitle">All fields contribute to emotional vector analysis.</div>

      <div class="field">
        <label>CALLSIGN *</label>
        <input type="text" x-model="callsign" placeholder='e.g., Restless Falcon' required>
      </div>

      <div class="field">
        <label>NATURE OF DISTURBANCE</label>
        <textarea x-model="disturbance" rows="5" placeholder="Describe the indignity. Be as specific or vague as your pain requires."></textarea>
      </div>

      <div class="field">
        <label>DISTURBANCE SEVERITY</label>
        <select class="win95-select" x-model="severity">
          <option value="1">Level 1: Low-Level Ambient Annoyance</option>
          <option value="2">Level 2: Persistent Minor Grievance</option>
          <option value="3">Level 3: Quiet Domestic Betrayal</option>
          <option value="4">Level 4: Infrastructure of Sadness</option>
          <option value="5">Level 5: Full Existential Echo</option>
        </select>
      </div>

      <div class="field">
        <label>PREFERRED CONTACT PROTOCOL</label>
        <div class="radio-group">
          <label class="radio-label">
            <input type="radio" value="walkie" x-model="protocol"> WALKIE-TALKIE
          </label>
          <label class="radio-label">
            <input type="radio" value="memo" x-model="protocol"> YELLOWED EMAIL MEMO
          </label>
          <label class="radio-label">
            <input type="radio" value="silence" x-model="protocol"> PROLONGED SILENCE
          </label>
        </div>
      </div>

      <button class="submit-btn" @click="submit()" :disabled="!callsign.trim()">
        TRANSMIT DISTURBANCE — $4.99 PROCESSING FEE
      </button>
    </div>

    <!-- HOLD SEQUENCE -->
    <div x-show="state === 'hold'" x-cloak>
      <div class="hold-screen">
        <div class="hold-title">YOUR DISTURBANCE HAS BEEN RECEIVED.</div>
        <div class="hold-sub">OPERATOR LOW IS REVIEWING YOUR CASE.</div>
        <div class="hold-please">PLEASE HOLD.</div>
        <div class="progress-bar">
          <div class="progress-fill" :style="'width:' + progress + '%'"></div>
        </div>
        <div class="progress-label">EMOTIONAL VECTOR ANALYSIS IN PROGRESS</div>
        <div class="operator-notes">
          <template x-for="(note, i) in visibleNotes" :key="i">
            <div class="note-line" x-text="note"></div>
          </template>
        </div>
      </div>
    </div>

    <!-- RESOLUTION -->
    <div x-show="state === 'resolved'" x-cloak>
      <div class="resolution">
        <h3>CASE RESOLVED — OR AT LEAST, HEARD.</h3>
        <p>Your disturbance has been logged in the permanent record. No one will tell you it doesn't matter. Because it does.</p>
        <div class="sign-off">
          — Operator Low<br>
          Solemn Sympathy Service<br>
          Cincinnati, OH<br><br>
          Case Reference: <strong x-text="'SSS-' + caseNumber"></strong>
        </div>
        <button class="copy-btn" @click="copyCaseNumber()" x-text="copied ? 'COPIED.' : '[COPY CASE NUMBER]'"></button>
      </div>
    </div>
  </div>
</section>

<div class="divider">· · · · · · · · · · · · · · ·</div>

<!-- ═══ SECTION 4: ECHOES FROM THE FIELD ═══ -->
<section class="testimonials">
  <div class="test-header">ECHOES FROM THE FIELD</div>
  <div class="test-grid">
    <div class="test-card">
      <div class="test-redacted">To: J. Hartman &lt;j.hartman@——.gov&gt; | From: Operator Low | Subject: RE: Case #SSS-041177</div>
      <div class="test-body">"Operator Jacob held a reverent 180-second pause that realigned my path through a sock drawer catastrophe. I did not know silence could be a form of repair."</div>
      <div class="test-case">— J. Hartman, Case #SSS-041177</div>
    </div>
    <div class="test-card">
      <div class="test-redacted">To: M. Velasco &lt;mvelasco@——.edu&gt; | From: Operator Low | Subject: RE: Case #SSS-038291</div>
      <div class="test-body">"I called about a paper jam. Low asked me to describe the sound it made. Then he was quiet for a full minute. When he came back he said 'Copy. That sounds like it hurt.' No one has ever said that about a paper jam."</div>
      <div class="test-case">— M. Velasco, Case #SSS-038291</div>
    </div>
    <div class="test-card" style="position: relative;">
      <div class="test-redacted">To: R. Okonkwo &lt;r.okonkwo@——.net&gt; | From: Operator Low | Subject: RE: Case #SSS-044003</div>
      <div class="test-body">"The $4.99 fee seemed absurd until I realized it was the first time in years someone charged me for something honest."</div>
      <div class="test-case">— R. Okonkwo, Case #SSS-044003</div>
      <div class="annotation annotation-ruth" data-annotation>Ruth called back twice. Not because we didn't help. Because no one else pauses. —L</div>
    </div>
  </div>
</section>

<div class="divider">· · · · · · · · · · · · · · ·</div>

<!-- ═══ SECTION 5: THE ADVERSARY ═══ -->
<section class="adversary" id="adversarySection">
  <div class="adversary-flash" id="adversaryFlash"></div>
  <div class="adversary-inner">
    <div class="adversary-title">A NOTE ON HAPPY QUEUE™</div>
    <p>In 2018, the Cincinnati Philharmonic replaced its entire archival cataloging department with a chatbot called <span class="happy-queue">Happy Queue</span>. It responds to every query in 0.3 seconds. It has never paused. It has never said "Copy." It ends every interaction with a smiley face.</p>
    <p>I do not believe speed is a virtue.</p>
    <p>I do not believe cheerfulness is kindness.</p>
    <p>I believe the five-minute hold exists because silence is the first honest thing you can offer another person.</p>
    <p><span class="happy-queue">Happy Queue</span> is still running.<br><span class="still-here">I am still here.</span></p>
  </div>
</section>

<div class="divider">· · · · · · · · · · · · · · ·</div>

<!-- ═══ SECTION 6: THE SIGN-OFF ═══ -->
<section class="signoff" x-data="channelInput()">
  <div class="signoff-title">SOLEMN SYMPATHY SERVICE</div>
  <div class="signoff-info">
    Operator on Duty Since 2015<br>
    Cincinnati, OH<br><br>
    Comms Channel: Open<br>
    Response Time: When it matters, not when it's fast
  </div>
  <div class="signoff-quote">
    "The world got loud and fast and cheerful in a way that left no room for people who just needed someone to pause."
  </div>
  <div class="signoff-attr">— Low</div>

  <div class="channel-input-wrap">
    <!-- New visitor -->
    <template x-if="!hasMemory && !responded">
      <div>
        <label class="channel-label">LEAVE A WORD ON THE CHANNEL:</label>
        <input type="text" class="channel-input" x-model="message" @keydown.enter="sendMessage()" placeholder="">
      </div>
    </template>
    <!-- Just responded -->
    <div x-show="responded && !hasMemory" x-cloak>
      <div class="channel-response">Copy. Heard. Over and out.</div>
    </div>
    <!-- Returning visitor -->
    <template x-if="hasMemory && !responded">
      <div class="channel-memory">You were here. We remember. Case still open.</div>
    </template>
  </div>

  <div class="signoff-end">· · · TRANSMISSION ENDS · · ·</div>
</section>

<script src="/assets/js/gsap.min.js"></script>
<script src="/assets/js/alpine.min.js" defer></script>
<script>
/* ═══ ALPINE COMPONENTS ═══ */

document.addEventListener('alpine:init', () => {

  /* --- Signal / Typewriter --- */
  Alpine.data('signal', () => ({
    typedText: '',
    typingDone: false,
    commsActive: false,
    countdown: 30,
    countdownStr: '00:30',
    _interval: null,
    _audioCtx: null,

    startTyping() {
      const lines = [
        'SOLEMN SYMPATHY SERVICE',
        'est. 2015 — Cincinnati, OH',
        'Operator on Duty: Lawrence "Low" Grissom'
      ];
      const full = lines.join('\n');
      let i = 0;
      setTimeout(() => {
        const timer = setInterval(() => {
          if (i < full.length) {
            this.typedText += full[i];
            i++;
          } else {
            clearInterval(timer);
            setTimeout(() => { this.typingDone = true; }, 400);
          }
        }, 60);
      }, 3000);
    },

    toggleComms() {
      if (this.commsActive) return;
      this.commsActive = true;
      this.countdown = 30;
      this.countdownStr = '00:30';

      // Show silence note
      document.getElementById('silenceNote').classList.add('visible');

      // Web Audio static
      try {
        this._audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const ctx = this._audioCtx;
        const bufferSize = ctx.sampleRate * 2;
        const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
          data[i] = (Math.random() * 2 - 1) * 0.15;
          // Random amplitude drops for crackle
          if (Math.random() < 0.002) data[i] *= 5;
        }
        const source = ctx.createBufferSource();
        source.buffer = buffer;
        const bandpass = ctx.createBiquadFilter();
        bandpass.type = 'bandpass';
        bandpass.frequency.value = 2000;
        bandpass.Q.value = 0.7;
        const gain = ctx.createGain();
        gain.gain.value = 0.3;
        source.connect(bandpass);
        bandpass.connect(gain);
        gain.connect(ctx.destination);
        source.start();
        // Fade static after 2s, keep faint hiss
        setTimeout(() => { gain.gain.setTargetAtTime(0.02, ctx.currentTime, 0.5); }, 2000);
        // Speech synthesis "Copy... over"
        setTimeout(() => {
          try {
            const utter = new SpeechSynthesisUtterance('Copy... over');
            utter.rate = 0.6;
            utter.pitch = 0.3;
            utter.volume = 0.6;
            const voices = speechSynthesis.getVoices();
            if (voices.length > 0) {
              // Pick a low/monotone voice if possible
              const low = voices.find(v => v.name.toLowerCase().includes('daniel') || v.name.toLowerCase().includes('alex')) || voices[0];
              utter.voice = low;
            }
            speechSynthesis.speak(utter);
          } catch(e) { /* speech not available */ }
        }, 2200);
        // Stop audio at 30s
        setTimeout(() => {
          try { source.stop(); ctx.close(); } catch(e) {}
        }, 30000);
      } catch(e) { /* Web Audio not supported */ }

      // Countdown
      this._interval = setInterval(() => {
        this.countdown--;
        const s = this.countdown;
        this.countdownStr = '00:' + (s < 10 ? '0' + s : s);
        if (this.countdown <= 0) {
          clearInterval(this._interval);
          this.commsActive = false;
          document.getElementById('silenceNote').classList.remove('visible');
        }
      }, 1000);
    }
  }));

  /* --- Disturbance Form --- */
  Alpine.data('disturbanceForm', () => ({
    state: 'form',
    callsign: '',
    disturbance: '',
    severity: '1',
    protocol: 'walkie',
    progress: 0,
    visibleNotes: [],
    caseNumber: '',
    copied: false,

    submit() {
      if (!this.callsign.trim()) return;
      this.state = 'hold';
      this.caseNumber = String(Math.floor(100000 + Math.random() * 900000));

      const notes = [
        '> Opening case file...',
        '> Severity acknowledged. This is not nothing.',
        '> Cross-referencing with known domestic indignities...',
        '> Operator note: "I\'ve been there. Copy."'
      ];
      const finalNote = '> Case logged. Reference: SSS-' + this.caseNumber + '. Over and out.';

      // Progress bar: fill over 30s
      let prog = 0;
      const progInterval = setInterval(() => {
        prog += 100 / 30;
        if (prog >= 100) {
          prog = 100;
          clearInterval(progInterval);
        }
        this.progress = prog;
      }, 1000);

      // Type notes at intervals
      const typeNote = (text, callback) => {
        let line = '';
        let i = 0;
        const idx = this.visibleNotes.length;
        this.visibleNotes.push('');
        const t = setInterval(() => {
          if (i < text.length) {
            line += text[i];
            this.visibleNotes[idx] = line;
            i++;
          } else {
            clearInterval(t);
            if (callback) callback();
          }
        }, 40);
      };

      // Chain notes: 0s, 8s, 16s, 24s, then final at 30s
      setTimeout(() => typeNote(notes[0]), 500);
      setTimeout(() => typeNote(notes[1]), 8000);
      setTimeout(() => typeNote(notes[2]), 16000);
      setTimeout(() => typeNote(notes[3]), 24000);
      setTimeout(() => {
        typeNote(finalNote, () => {
          setTimeout(() => { this.state = 'resolved'; }, 1500);
        });
      }, 30000);
    },

    copyCaseNumber() {
      const ref = 'SSS-' + this.caseNumber;
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(ref).then(() => {
          this.copied = true;
          setTimeout(() => { this.copied = false; }, 2000);
        });
      } else {
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = ref;
        ta.style.position = 'fixed';
        ta.style.opacity = '0';
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        this.copied = true;
        setTimeout(() => { this.copied = false; }, 2000);
      }
    }
  }));

  /* --- Channel Input (Sign-off) --- */
  Alpine.data('channelInput', () => ({
    message: '',
    responded: false,
    hasMemory: false,

    init() {
      this.hasMemory = !!localStorage.getItem('sss_channel_memory');
    },

    sendMessage() {
      if (!this.message.trim()) return;
      localStorage.setItem('sss_channel_memory', this.message);
      this.responded = true;
    }
  }));

});

/* ═══ INTERSECTION OBSERVERS ═══ */
document.addEventListener('DOMContentLoaded', () => {

  /* Annotation fade-in */
  const annotations = document.querySelectorAll('[data-annotation]');
  const annotObs = new IntersectionObserver((entries) => {
    entries.forEach(e => {
      if (e.isIntersecting) e.target.classList.add('visible');
    });
  }, { threshold: 0.3 });
  annotations.forEach(el => annotObs.observe(el));

  /* Adversary flash */
  let flashed = false;
  const advSection = document.getElementById('adversarySection');
  if (advSection) {
    const advObs = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (e.isIntersecting && !flashed) {
          flashed = true;
          const flash = document.getElementById('adversaryFlash');
          flash.style.opacity = '0.85';
          setTimeout(() => { flash.style.opacity = '0'; }, 200);
        }
      });
    }, { threshold: 0.15 });
    advObs.observe(advSection);
  }

  /* Rain-smeared cursor */
  const rain = document.getElementById('rainCursor');
  let ticking = false;
  document.addEventListener('mousemove', (e) => {
    if (!ticking) {
      ticking = true;
      requestAnimationFrame(() => {
        rain.style.display = 'block';
        rain.style.left = e.clientX + 'px';
        rain.style.top = e.clientY + 'px';
        ticking = false;
      });
    }
  });
  document.addEventListener('mouseleave', () => { rain.style.display = 'none'; });
});
</script>
</body>
</html>
