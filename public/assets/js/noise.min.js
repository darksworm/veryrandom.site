/**
 * Simplex-style noise â€” standalone, no dependencies.
 * Globals: createNoise2D(), createNoise3D()
 * Each returns a function (x, y[, z]) => float in [-1, 1].
 */
(function(){
"use strict";

// Permutation table (doubled for wrapping)
function buildPerm(seed){
  var p=new Uint8Array(256);
  var i;
  for(i=0;i<256;i++) p[i]=i;
  // Fisher-Yates with seed-derived PRNG
  var s=seed>>>0||0;
  function rng(){s^=s<<13;s^=s>>>17;s^=s<<5;return(s>>>0)/4294967296;}
  for(i=255;i>0;i--){
    var j=(rng()*(i+1))|0;
    var t=p[i];p[i]=p[j];p[j]=t;
  }
  var perm=new Uint8Array(512);
  var permMod12=new Uint8Array(512);
  for(i=0;i<512;i++){perm[i]=p[i&255];permMod12[i]=perm[i]%12;}
  return{perm:perm,permMod12:permMod12};
}

// 2D gradients
var grad2=[
  [1,1],[-1,1],[1,-1],[-1,-1],
  [1,0],[-1,0],[0,1],[0,-1]
];

// 3D gradients
var grad3=[
  [1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],
  [1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],
  [0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]
];

var F2=0.5*(Math.sqrt(3)-1);
var G2=(3-Math.sqrt(3))/6;
var F3=1/3;
var G3=1/6;

function dot2(g,x,y){return g[0]*x+g[1]*y;}
function dot3(g,x,y,z){return g[0]*x+g[1]*y+g[2]*z;}

window.createNoise2D=function(seed){
  var t=buildPerm(seed||Math.random()*4294967296);
  var perm=t.perm, pm12=t.permMod12;
  return function(xin,yin){
    var s=(xin+yin)*F2;
    var i=Math.floor(xin+s), j=Math.floor(yin+s);
    var tt=(i+j)*G2;
    var x0=xin-(i-tt), y0=yin-(j-tt);
    var i1,j1;
    if(x0>y0){i1=1;j1=0;}else{i1=0;j1=1;}
    var x1=x0-i1+G2, y1=y0-j1+G2;
    var x2=x0-1+2*G2, y2=y0-1+2*G2;
    var ii=i&255, jj=j&255;
    var n0,n1,n2;
    var t0=0.5-x0*x0-y0*y0;
    if(t0<0) n0=0; else{t0*=t0;var gi0=pm12[ii+perm[jj]]%8;n0=t0*t0*dot2(grad2[gi0],x0,y0);}
    var t1=0.5-x1*x1-y1*y1;
    if(t1<0) n1=0; else{t1*=t1;var gi1=pm12[ii+i1+perm[jj+j1]]%8;n1=t1*t1*dot2(grad2[gi1],x1,y1);}
    var t2=0.5-x2*x2-y2*y2;
    if(t2<0) n2=0; else{t2*=t2;var gi2=pm12[ii+1+perm[jj+1]]%8;n2=t2*t2*dot2(grad2[gi2],x2,y2);}
    return 70*(n0+n1+n2);
  };
};

window.createNoise3D=function(seed){
  var t=buildPerm(seed||Math.random()*4294967296);
  var perm=t.perm, pm12=t.permMod12;
  return function(xin,yin,zin){
    var s=(xin+yin+zin)*F3;
    var i=Math.floor(xin+s), j=Math.floor(yin+s), k=Math.floor(zin+s);
    var tt=(i+j+k)*G3;
    var x0=xin-(i-tt), y0=yin-(j-tt), z0=zin-(k-tt);
    var i1,j1,k1,i2,j2,k2;
    if(x0>=y0){
      if(y0>=z0){i1=1;j1=0;k1=0;i2=1;j2=1;k2=0;}
      else if(x0>=z0){i1=1;j1=0;k1=0;i2=1;j2=0;k2=1;}
      else{i1=0;j1=0;k1=1;i2=1;j2=0;k2=1;}
    }else{
      if(y0<z0){i1=0;j1=0;k1=1;i2=0;j2=1;k2=1;}
      else if(x0<z0){i1=0;j1=1;k1=0;i2=0;j2=1;k2=1;}
      else{i1=0;j1=1;k1=0;i2=1;j2=1;k2=0;}
    }
    var x1=x0-i1+G3, y1=y0-j1+G3, z1=z0-k1+G3;
    var x2=x0-i2+2*G3, y2=y0-j2+2*G3, z2=z0-k2+2*G3;
    var x3=x0-1+3*G3, y3=y0-1+3*G3, z3=z0-1+3*G3;
    var ii=i&255, jj=j&255, kk=k&255;
    var n0,n1,n2,n3;
    var t0=0.6-x0*x0-y0*y0-z0*z0;
    if(t0<0) n0=0; else{t0*=t0;n0=t0*t0*dot3(grad3[pm12[ii+perm[jj+perm[kk]]]],x0,y0,z0);}
    var t1=0.6-x1*x1-y1*y1-z1*z1;
    if(t1<0) n1=0; else{t1*=t1;n1=t1*t1*dot3(grad3[pm12[ii+i1+perm[jj+j1+perm[kk+k1]]]],x1,y1,z1);}
    var t2=0.6-x2*x2-y2*y2-z2*z2;
    if(t2<0) n2=0; else{t2*=t2;n2=t2*t2*dot3(grad3[pm12[ii+i2+perm[jj+j2+perm[kk+k2]]]],x2,y2,z2);}
    var t3=0.6-x3*x3-y3*y3-z3*z3;
    if(t3<0) n3=0; else{t3*=t3;n3=t3*t3*dot3(grad3[pm12[ii+1+perm[jj+1+perm[kk+1]]]],x3,y3,z3);}
    return 32*(n0+n1+n2+n3);
  };
};

})();
